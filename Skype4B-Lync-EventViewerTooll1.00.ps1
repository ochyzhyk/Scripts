########################################################################
# Name: Lync / Skype for Business Centalised Event Viewer Tool
# Version: v1.0.0 (8/7/2016)
# Original Release Date: 8/7/2016
# Created By: James Cussen
# Web Site: http://www.myskypelab.com
#
# Purpose: This tool is designed to get Lync and Skype for Business server events.
# Notes: This is a Powershell tool. To run the tool, open it from the Powershell command line or Right Click and select "Run with Powershell".
# 		 For more information on the requirements for setting up and using this tool please visit http://www.myskypelab.com.
#
# Powershell Version: Supported on Version 3.0 and above
#
# Copyright: Copyright (c) 2016, James Cussen (www.myskypelab.com) All rights reserved.
# Licence: 	Redistribution and use of script, source and binary forms, with or without modification, are permitted provided that the following conditions are met:
#				1) Redistributions of script code must retain the above copyright notice, this list of conditions and the following disclaimer.
#				2) Redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer.
#				3) Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution.
#				4) This license does not include any resale or commercial use of this software.
#				5) Any portion of this software may not be reproduced, duplicated, copied, sold, resold, or otherwise exploited for any commercial purpose without express written consent of James Cussen.
#			THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; LOSS OF GOODWILL OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
#
# Release Notes:
# 1.00 Initial Release.
#
########################################################################


###############GLOBAL VARIABLES##############

#NOTE: As of the current release of Skype for Business (CU3) logging is done in Event Viewer under the name "Lync Server". If this changes to Skype for Business at some point then this may need to be edited.
$LogName = "Lync Server"

#############################################


$theVersion = $PSVersionTable.PSVersion
$MajorVersion = $theVersion.Major

Write-Host ""
Write-Host "--------------------------------------------------------------"
Write-Host "Powershell Version Check..." -foreground "yellow"
if($MajorVersion -eq  "1")
{
	Write-Host "This machine only has Version 1 Powershell installed.  This version of Powershell is not supported." -foreground "red"
}
elseif($MajorVersion -eq  "2")
{
	Write-Host "This machine has Version 2 Powershell installed. This version of Powershell is not supported." -foreground "red"
}
elseif($MajorVersion -eq  "3")
{
	Write-Host "This machine has version 3 Powershell installed. CHECK PASSED!" -foreground "green"
}
elseif($MajorVersion -eq  "4")
{
	Write-Host "This machine has version 4 Powershell installed. CHECK PASSED!" -foreground "green"
}
elseif($MajorVersion -eq  "5")
{
	Write-Host "This machine has version 5 Powershell installed. CHECK PASSED!" -foreground "green"
}
else
{
	Write-Host "This machine has version $MajorVersion Powershell installed. Unknown level of support for this version." -foreground "yellow"
}
Write-Host "--------------------------------------------------------------"
Write-Host ""

Function Get-MyModule 
{ 
Param([string]$name) 
	
	if(-not(Get-Module -name $name)) 
	{ 
		if(Get-Module -ListAvailable | Where-Object { $_.name -eq $name }) 
		{ 
			Import-Module -Name $name 
			return $true 
		} #end if module available then import 
		else 
		{ 
			return $false 
		} #module not available 
	} # end if not module 
	else 
	{ 
		return $true 
	} #module already loaded 
} #end function get-MyModule 


$Script:LyncModuleAvailable = $false
$Script:SkypeModuleAvailable = $false

Write-Host "--------------------------------------------------------------"
#Import Lync Module
if(Get-MyModule "Lync")
{
	Invoke-Expression "Import-Module Lync"
	Write-Host "Imported Lync Module..." -foreground "green"
	$Script:LyncModuleAvailable = $true
}
else
{
	Write-Host "Unable to import Lync Module..." -foreground "yellow"
}
#Import SkypeforBusiness Module
if(Get-MyModule "SkypeforBusiness")
{
	Invoke-Expression "Import-Module SkypeforBusiness"
	Write-Host "Imported SkypeforBusiness Module..." -foreground "green"
	$Script:SkypeModuleAvailable = $true
}
else
{
	Write-Host "Unable to import SkypeforBusiness Module... (Expected on a Lync 2013 system)" -foreground "yellow"
}

$scriptpath = $MyInvocation.MyCommand.Path
$dir = Split-Path $scriptpath
$fso = New-Object -ComObject Scripting.FileSystemObject
$shortname = $fso.GetFolder($dir).Path




$script:CancelScan = $false

[void][reflection.assembly]::loadwithpartialname("system.drawing")

[byte[]]$CriticalIcon = @(137, 80, 78, 71, 13, 10, 26, 10, 0, 0, 0, 13, 73, 72, 68, 82, 0, 0, 0, 22, 0, 0, 0, 22, 8, 6, 0, 0, 0, 196, 180, 108, 59, 0, 0, 0, 6, 98, 75, 71, 68, 0, 255, 0, 255, 0, 255, 160, 189, 167, 147, 0, 0, 0, 9, 112, 72, 89, 115, 0, 0, 11, 19, 0, 0, 11, 19, 1, 0, 154, 156, 24, 0, 0, 0, 7, 116, 73, 77, 69, 7, 224, 7, 6, 1, 42, 59, 146, 121, 125, 213, 0, 0, 6, 40, 73, 68, 65, 84, 56, 203, 69, 149, 107, 140, 84, 119, 25, 198, 127, 255, 255, 57, 51, 123, 206, 204, 236, 101, 246, 54, 179, 11, 91, 119, 229, 126, 167, 93, 98, 147, 102, 123, 161, 182, 96, 181, 180, 69, 130, 232, 135, 165, 105, 221, 32, 6, 165, 161, 52, 177, 27, 106, 108, 75, 236, 7, 197, 70, 52, 162, 177, 180, 154, 40, 73, 37, 180, 40, 40, 168, 4, 81, 151, 18, 46, 46, 178, 93, 210, 93, 10, 123, 105, 103, 217, 157, 153, 101, 47, 115, 61, 115, 230, 92, 254, 126, 0, 233, 251, 249, 205, 147, 231, 125, 243, 228, 247, 8, 0, 165, 20, 98, 201, 18, 24, 28, 228, 229, 71, 31, 101, 251, 161, 67, 90, 58, 153, 12, 196, 234, 235, 235, 179, 183, 166, 158, 116, 237, 210, 60, 77, 8, 132, 148, 200, 64, 192, 55, 35, 145, 127, 55, 54, 53, 157, 25, 79, 165, 212, 130, 182, 54, 75, 8, 1, 192, 200, 200, 40, 109, 109, 173, 244, 247, 95, 69, 40, 199, 97, 125, 119, 55, 127, 223, 183, 15, 128, 254, 161, 161, 6, 221, 243, 191, 98, 77, 140, 111, 102, 122, 250, 75, 42, 149, 146, 110, 34, 129, 95, 40, 32, 165, 196, 104, 106, 194, 156, 55, 15, 189, 185, 25, 89, 91, 251, 123, 173, 186, 122, 223, 104, 42, 61, 88, 115, 241, 146, 189, 162, 235, 121, 174, 92, 233, 99, 245, 234, 85, 136, 211, 189, 189, 124, 177, 189, 29, 165, 148, 252, 104, 108, 108, 113, 105, 98, 98, 183, 59, 48, 248, 124, 169, 167, 7, 235, 226, 69, 252, 201, 73, 180, 128, 142, 210, 116, 0, 84, 217, 70, 9, 13, 115, 225, 2, 234, 214, 175, 35, 252, 192, 3, 227, 129, 249, 243, 127, 93, 176, 203, 239, 44, 105, 253, 92, 2, 96, 34, 49, 202, 237, 27, 128, 129, 68, 98, 117, 49, 145, 248, 109, 254, 196, 137, 85, 246, 137, 19, 248, 51, 51, 72, 211, 68, 4, 130, 40, 64, 124, 182, 10, 74, 225, 91, 22, 202, 243, 8, 45, 91, 70, 195, 115, 207, 18, 108, 95, 243, 150, 163, 212, 222, 69, 31, 157, 79, 136, 47, 111, 65, 3, 184, 60, 48, 16, 179, 83, 201, 55, 11, 39, 255, 250, 176, 253, 222, 251, 248, 182, 141, 94, 95, 135, 242, 21, 194, 135, 255, 255, 240, 238, 120, 62, 90, 164, 18, 33, 53, 220, 84, 154, 98, 127, 63, 193, 150, 150, 118, 61, 30, 159, 29, 10, 71, 47, 28, 60, 112, 192, 149, 7, 223, 125, 87, 150, 179, 217, 13, 86, 223, 135, 79, 149, 142, 29, 71, 121, 30, 213, 237, 237, 44, 218, 243, 10, 141, 79, 60, 129, 18, 128, 239, 3, 220, 246, 236, 186, 132, 23, 46, 96, 94, 247, 247, 104, 120, 230, 41, 132, 105, 224, 165, 211, 76, 29, 58, 68, 241, 250, 245, 109, 33, 61, 176, 124, 66, 41, 180, 159, 239, 255, 105, 221, 236, 208, 240, 111, 74, 239, 31, 173, 245, 111, 12, 19, 94, 177, 130, 37, 175, 254, 128, 216, 131, 29, 212, 220, 119, 31, 165, 169, 41, 138, 131, 215, 16, 186, 134, 111, 219, 132, 22, 47, 226, 158, 93, 187, 168, 91, 191, 14, 99, 249, 50, 172, 84, 138, 210, 208, 13, 252, 116, 90, 105, 241, 120, 149, 104, 110, 54, 178, 183, 38, 255, 38, 147, 99, 99, 143, 145, 74, 207, 247, 175, 244, 33, 195, 33, 188, 146, 69, 217, 178, 0, 8, 214, 214, 210, 182, 115, 39, 245, 155, 55, 225, 207, 76, 19, 94, 186, 148, 57, 187, 119, 19, 92, 190, 140, 204, 244, 52, 185, 92, 14, 43, 51, 139, 239, 122, 40, 215, 19, 86, 79, 15, 165, 116, 186, 243, 212, 153, 115, 101, 173, 107, 235, 214, 61, 206, 7, 31, 44, 247, 175, 94, 69, 134, 195, 120, 217, 28, 51, 151, 47, 35, 91, 91, 209, 98, 49, 92, 4, 198, 162, 69, 80, 19, 37, 186, 121, 51, 242, 158, 22, 44, 219, 38, 59, 57, 201, 181, 215, 94, 101, 230, 196, 95, 40, 21, 242, 20, 172, 34, 217, 27, 55, 48, 59, 30, 18, 237, 107, 31, 28, 149, 65, 195, 216, 104, 15, 94, 67, 24, 6, 8, 16, 1, 137, 55, 126, 147, 145, 215, 95, 103, 226, 220, 57, 242, 197, 2, 69, 223, 199, 88, 247, 56, 229, 104, 53, 185, 108, 150, 76, 50, 201, 240, 27, 63, 196, 250, 243, 113, 40, 89, 248, 229, 50, 190, 227, 80, 46, 22, 97, 102, 154, 241, 79, 19, 139, 165, 235, 56, 21, 126, 102, 6, 116, 13, 164, 64, 34, 208, 165, 68, 141, 140, 48, 220, 253, 50, 169, 75, 151, 200, 231, 243, 20, 74, 37, 178, 217, 44, 217, 201, 73, 110, 254, 242, 23, 216, 71, 142, 80, 33, 36, 1, 33, 8, 8, 8, 0, 26, 32, 242, 5, 166, 111, 77, 9, 93, 74, 169, 132, 174, 11, 33, 5, 82, 8, 132, 235, 96, 101, 102, 41, 164, 83, 232, 85, 17, 138, 153, 12, 118, 54, 139, 235, 186, 56, 142, 131, 155, 203, 33, 109, 7, 211, 52, 81, 128, 20, 18, 95, 41, 188, 59, 226, 104, 2, 161, 73, 116, 161, 24, 10, 206, 109, 153, 207, 248, 4, 110, 185, 76, 97, 234, 22, 229, 236, 44, 198, 189, 237, 152, 223, 249, 46, 246, 156, 57, 184, 249, 60, 202, 247, 65, 8, 68, 56, 76, 69, 103, 39, 34, 20, 194, 57, 124, 24, 223, 247, 241, 165, 68, 220, 137, 163, 31, 142, 208, 16, 139, 9, 153, 45, 230, 143, 154, 171, 87, 98, 165, 146, 204, 166, 146, 148, 115, 57, 42, 238, 93, 131, 182, 253, 219, 216, 177, 24, 142, 83, 70, 42, 133, 243, 230, 62, 66, 55, 111, 82, 21, 141, 82, 89, 87, 71, 117, 87, 23, 149, 91, 59, 209, 164, 68, 87, 10, 221, 117, 169, 104, 108, 192, 173, 174, 166, 49, 30, 63, 39, 27, 154, 155, 143, 171, 150, 22, 242, 82, 224, 101, 50, 24, 11, 23, 98, 236, 124, 1, 189, 237, 243, 152, 21, 21, 132, 17, 168, 31, 255, 136, 154, 11, 231, 81, 223, 223, 67, 240, 250, 199, 68, 162, 53, 84, 53, 54, 16, 223, 253, 18, 53, 91, 182, 32, 108, 27, 205, 178, 8, 127, 225, 126, 244, 134, 198, 194, 39, 137, 177, 211, 210, 46, 187, 151, 130, 115, 230, 38, 106, 55, 108, 64, 83, 128, 175, 8, 148, 138, 84, 70, 194, 152, 182, 141, 251, 179, 253, 132, 46, 93, 32, 168, 235, 152, 197, 2, 238, 43, 123, 16, 255, 233, 197, 48, 77, 68, 33, 143, 178, 109, 116, 33, 8, 70, 107, 144, 29, 15, 161, 215, 214, 30, 52, 66, 134, 173, 125, 107, 199, 14, 37, 66, 230, 39, 129, 218, 186, 141, 254, 240, 176, 230, 244, 245, 33, 70, 134, 9, 70, 34, 56, 199, 254, 136, 254, 143, 211, 4, 165, 68, 19, 2, 93, 8, 100, 46, 143, 211, 223, 143, 23, 8, 144, 57, 252, 7, 236, 35, 71, 208, 241, 209, 55, 110, 194, 125, 100, 237, 80, 101, 172, 97, 239, 253, 107, 218, 63, 21, 0, 103, 251, 250, 66, 97, 41, 247, 122, 189, 189, 47, 102, 126, 178, 15, 187, 255, 42, 70, 60, 134, 102, 91, 4, 60, 15, 77, 74, 52, 196, 109, 98, 1, 202, 243, 113, 195, 97, 252, 236, 44, 170, 100, 35, 158, 217, 136, 211, 249, 44, 94, 115, 243, 182, 222, 171, 87, 222, 217, 253, 205, 109, 222, 93, 108, 93, 28, 24, 136, 201, 66, 161, 59, 56, 126, 243, 5, 235, 237, 183, 201, 253, 233, 24, 70, 64, 18, 8, 135, 209, 145, 104, 183, 147, 132, 188, 35, 236, 101, 115, 184, 85, 17, 68, 215, 54, 74, 143, 173, 131, 198, 134, 253, 149, 145, 240, 107, 43, 22, 47, 158, 1, 16, 189, 253, 31, 210, 190, 98, 37, 0, 131, 163, 163, 245, 249, 153, 153, 29, 21, 182, 253, 146, 113, 253, 227, 200, 244, 175, 14, 224, 95, 56, 79, 133, 7, 129, 128, 134, 14, 72, 215, 195, 169, 169, 66, 60, 249, 52, 206, 211, 95, 101, 182, 186, 170, 40, 204, 208, 139, 209, 104, 245, 239, 86, 46, 93, 90, 4, 248, 111, 111, 239, 109, 18, 158, 57, 123, 150, 181, 29, 29, 0, 28, 61, 121, 82, 182, 52, 53, 61, 172, 193, 27, 149, 166, 185, 212, 180, 172, 170, 242, 141, 33, 156, 212, 4, 34, 16, 68, 204, 157, 139, 219, 212, 172, 166, 74, 37, 75, 41, 255, 180, 17, 10, 237, 26, 30, 24, 28, 253, 218, 55, 190, 238, 1, 140, 142, 142, 210, 218, 218, 250, 89, 45, 36, 147, 73, 226, 241, 56, 0, 231, 122, 122, 196, 234, 142, 14, 241, 175, 83, 167, 230, 84, 24, 198, 166, 72, 101, 229, 42, 37, 132, 240, 92, 23, 183, 92, 86, 202, 243, 250, 234, 234, 162, 239, 245, 156, 191, 60, 182, 253, 185, 78, 37, 132, 224, 204, 153, 127, 178, 118, 237, 35, 119, 187, 224, 127, 144, 155, 215, 123, 106, 201, 184, 194, 0, 0, 0, 0, 73, 69, 78, 68, 174, 66, 96, 130)
$CriticalMem = New-Object IO.MemoryStream($CriticalIcon, 0, $CriticalIcon.Length)
$CriticalImage = [System.Drawing.Image]::FromStream($CriticalMem)

[byte[]]$ErrorIcon = @(137, 80, 78, 71, 13, 10, 26, 10, 0, 0, 0, 13, 73, 72, 68, 82, 0, 0, 0, 22, 0, 0, 0, 22, 8, 6, 0, 0, 0, 196, 180, 108, 59, 0, 0, 0, 6, 98, 75, 71, 68, 0, 255, 0, 255, 0, 255, 160, 189, 167, 147, 0, 0, 0, 9, 112, 72, 89, 115, 0, 0, 11, 19, 0, 0, 11, 19, 1, 0, 154, 156, 24, 0, 0, 0, 7, 116, 73, 77, 69, 7, 224, 7, 6, 1, 43, 23, 185, 186, 32, 119, 0, 0, 5, 177, 73, 68, 65, 84, 56, 203, 85, 149, 91, 140, 149, 87, 25, 134, 159, 245, 173, 245, 255, 251, 223, 176, 103, 51, 231, 1, 166, 133, 224, 0, 101, 40, 32, 40, 45, 211, 118, 72, 27, 139, 51, 216, 16, 137, 173, 49, 166, 49, 38, 68, 72, 154, 170, 49, 49, 220, 120, 231, 133, 33, 105, 36, 105, 141, 135, 11, 83, 37, 90, 99, 173, 53, 98, 172, 141, 74, 106, 56, 76, 161, 148, 131, 130, 50, 157, 225, 56, 195, 113, 24, 246, 12, 51, 155, 125, 248, 231, 63, 173, 229, 197, 6, 140, 43, 89, 87, 43, 223, 147, 247, 125, 191, 47, 223, 82, 0, 206, 57, 230, 245, 247, 19, 30, 61, 10, 192, 216, 196, 164, 190, 59, 57, 225, 181, 22, 139, 237, 181, 242, 204, 182, 108, 46, 234, 17, 165, 80, 2, 218, 203, 217, 124, 83, 211, 145, 98, 71, 231, 193, 59, 165, 146, 123, 172, 167, 39, 84, 74, 1, 48, 50, 114, 153, 222, 222, 30, 78, 158, 60, 129, 138, 43, 85, 252, 166, 2, 15, 206, 208, 185, 225, 166, 86, 163, 183, 38, 183, 110, 236, 176, 211, 165, 65, 117, 115, 92, 152, 184, 78, 22, 197, 100, 89, 198, 130, 174, 46, 244, 138, 199, 209, 221, 75, 112, 45, 173, 191, 81, 205, 173, 123, 143, 253, 235, 204, 232, 0, 94, 212, 185, 109, 128, 227, 31, 31, 167, 111, 83, 31, 234, 1, 208, 57, 167, 135, 175, 94, 235, 173, 140, 95, 217, 197, 232, 185, 157, 156, 30, 154, 23, 159, 58, 6, 149, 25, 68, 129, 210, 6, 231, 28, 54, 73, 112, 8, 222, 210, 229, 44, 120, 254, 5, 114, 125, 207, 222, 178, 203, 86, 254, 60, 204, 178, 125, 235, 87, 174, 184, 246, 128, 247, 16, 60, 114, 227, 230, 234, 234, 165, 11, 191, 14, 255, 182, 255, 179, 238, 208, 251, 72, 117, 22, 201, 231, 177, 153, 37, 191, 176, 155, 194, 134, 62, 178, 90, 153, 153, 143, 135, 32, 75, 113, 113, 130, 139, 19, 188, 158, 213, 52, 191, 188, 11, 214, 63, 241, 179, 233, 52, 253, 126, 255, 218, 181, 37, 0, 229, 156, 227, 244, 232, 133, 142, 100, 226, 250, 107, 241, 95, 247, 239, 144, 15, 254, 132, 18, 192, 24, 176, 150, 172, 30, 178, 250, 245, 95, 210, 182, 101, 27, 54, 137, 25, 253, 193, 110, 74, 239, 190, 133, 89, 208, 2, 206, 225, 226, 24, 93, 108, 39, 191, 227, 91, 113, 186, 254, 137, 239, 94, 153, 44, 189, 249, 213, 173, 131, 145, 252, 226, 237, 119, 37, 157, 153, 218, 158, 13, 159, 217, 161, 14, 254, 5, 37, 14, 180, 110, 20, 89, 7, 65, 0, 45, 173, 196, 153, 37, 69, 97, 186, 151, 97, 163, 24, 28, 224, 64, 25, 31, 59, 83, 162, 254, 222, 59, 190, 189, 52, 186, 187, 123, 65, 113, 197, 38, 231, 208, 63, 253, 241, 27, 109, 179, 23, 46, 236, 203, 254, 248, 86, 171, 46, 221, 132, 32, 192, 161, 26, 41, 137, 224, 226, 152, 104, 102, 154, 56, 154, 99, 246, 244, 71, 76, 254, 254, 87, 152, 36, 69, 137, 65, 0, 133, 66, 25, 141, 220, 190, 133, 180, 117, 54, 203, 146, 30, 127, 240, 78, 233, 3, 51, 113, 237, 234, 22, 153, 188, 177, 156, 145, 179, 208, 210, 132, 115, 15, 186, 121, 191, 9, 74, 19, 93, 248, 132, 187, 83, 37, 92, 146, 224, 87, 102, 209, 65, 14, 235, 44, 54, 179, 88, 231, 26, 53, 89, 74, 250, 209, 97, 100, 195, 83, 59, 15, 29, 62, 242, 138, 201, 226, 120, 123, 60, 242, 111, 140, 56, 44, 210, 32, 102, 32, 10, 180, 0, 213, 89, 154, 118, 126, 27, 127, 213, 90, 84, 154, 50, 181, 239, 13, 202, 39, 62, 196, 229, 2, 50, 107, 193, 90, 172, 3, 231, 44, 246, 63, 39, 145, 241, 139, 108, 127, 233, 197, 175, 155, 188, 239, 127, 169, 242, 201, 57, 204, 188, 60, 88, 135, 88, 208, 202, 97, 4, 60, 17, 42, 97, 157, 164, 216, 130, 91, 188, 20, 21, 197, 132, 162, 153, 139, 83, 148, 151, 130, 181, 247, 205, 57, 172, 114, 164, 53, 104, 171, 87, 25, 187, 120, 113, 149, 201, 146, 56, 39, 229, 187, 56, 167, 17, 11, 158, 118, 24, 231, 176, 214, 50, 19, 86, 41, 87, 193, 205, 133, 228, 106, 33, 42, 141, 193, 89, 140, 161, 145, 191, 82, 88, 235, 80, 202, 161, 129, 68, 167, 120, 97, 149, 233, 169, 146, 50, 74, 107, 135, 54, 74, 156, 195, 19, 135, 202, 50, 106, 209, 28, 213, 168, 142, 83, 224, 27, 72, 227, 24, 27, 134, 72, 18, 163, 112, 24, 95, 227, 30, 76, 142, 56, 172, 179, 56, 7, 70, 1, 198, 35, 77, 83, 196, 58, 185, 44, 143, 44, 197, 183, 17, 105, 26, 51, 83, 45, 115, 111, 174, 138, 18, 240, 140, 193, 51, 144, 68, 49, 181, 90, 141, 122, 88, 199, 101, 182, 49, 17, 70, 163, 180, 32, 90, 208, 90, 35, 90, 200, 121, 80, 54, 62, 75, 122, 122, 148, 84, 234, 245, 253, 243, 55, 61, 67, 120, 119, 154, 217, 106, 153, 56, 75, 49, 70, 163, 141, 65, 121, 130, 50, 32, 90, 97, 179, 140, 56, 142, 65, 129, 103, 52, 34, 141, 171, 140, 70, 180, 70, 176, 152, 182, 34, 89, 177, 149, 69, 139, 187, 143, 73, 199, 162, 69, 127, 182, 139, 31, 165, 236, 7, 216, 52, 193, 220, 87, 161, 148, 66, 161, 17, 5, 190, 239, 19, 228, 243, 4, 185, 0, 109, 52, 218, 211, 104, 79, 48, 190, 70, 139, 70, 41, 141, 138, 19, 188, 245, 79, 226, 90, 219, 107, 103, 207, 158, 249, 135, 140, 94, 188, 116, 220, 54, 183, 190, 55, 127, 96, 59, 42, 73, 81, 90, 161, 68, 80, 74, 16, 17, 196, 131, 92, 16, 144, 207, 231, 9, 242, 1, 198, 120, 32, 247, 223, 180, 32, 70, 16, 101, 49, 133, 5, 100, 159, 222, 76, 20, 204, 223, 83, 169, 71, 161, 72, 83, 115, 166, 58, 23, 191, 62, 255, 249, 47, 166, 193, 170, 117, 16, 205, 61, 132, 26, 163, 192, 194, 188, 98, 145, 166, 182, 118, 10, 45, 109, 120, 57, 15, 17, 26, 174, 164, 225, 72, 156, 69, 158, 250, 60, 81, 207, 170, 107, 65, 177, 249, 119, 175, 236, 250, 70, 34, 47, 110, 121, 206, 5, 243, 11, 167, 188, 21, 189, 63, 42, 126, 237, 85, 188, 71, 87, 98, 43, 101, 180, 105, 168, 198, 135, 240, 230, 85, 162, 203, 195, 36, 227, 231, 73, 235, 85, 2, 17, 124, 17, 76, 150, 52, 34, 232, 27, 36, 222, 252, 66, 20, 55, 53, 239, 142, 156, 189, 254, 127, 107, 243, 212, 232, 249, 46, 87, 158, 253, 94, 48, 121, 253, 59, 115, 127, 216, 199, 189, 195, 239, 147, 107, 41, 34, 190, 135, 238, 234, 70, 252, 60, 226, 44, 250, 238, 29, 252, 168, 70, 82, 175, 145, 230, 91, 137, 182, 190, 76, 181, 119, 67, 85, 119, 45, 222, 235, 23, 10, 123, 55, 111, 220, 88, 3, 80, 255, 60, 55, 204, 103, 214, 60, 14, 192, 249, 241, 171, 237, 213, 233, 233, 111, 230, 210, 104, 119, 112, 105, 184, 48, 245, 206, 155, 164, 99, 35, 228, 181, 197, 215, 10, 223, 89, 84, 234, 72, 114, 5, 178, 167, 191, 64, 237, 115, 219, 185, 167, 77, 104, 115, 185, 87, 219, 59, 23, 189, 189, 113, 221, 154, 72, 41, 197, 15, 95, 219, 211, 80, 124, 232, 232, 49, 158, 123, 230, 105, 0, 246, 31, 56, 40, 143, 116, 180, 60, 107, 112, 123, 10, 249, 252, 154, 160, 50, 235, 187, 235, 87, 252, 234, 157, 219, 4, 249, 60, 182, 185, 141, 122, 219, 162, 116, 42, 78, 102, 194, 40, 254, 109, 87, 87, 215, 79, 198, 199, 46, 142, 125, 249, 165, 175, 100, 0, 87, 198, 198, 248, 212, 178, 101, 255, 139, 226, 246, 237, 219, 44, 92, 184, 16, 128, 163, 67, 67, 106, 93, 127, 191, 58, 121, 248, 200, 210, 90, 88, 127, 178, 163, 179, 163, 95, 107, 83, 72, 226, 148, 123, 149, 114, 53, 154, 11, 63, 236, 125, 108, 213, 137, 149, 203, 151, 143, 57, 231, 80, 74, 113, 224, 192, 223, 25, 24, 24, 124, 248, 119, 254, 23, 173, 190, 168, 69, 249, 31, 227, 242, 0, 0, 0, 0, 73, 69, 78, 68, 174, 66, 96, 130)
$ErrorMem = New-Object IO.MemoryStream($ErrorIcon, 0, $ErrorIcon.Length)
$ErrorImage = [System.Drawing.Image]::FromStream($ErrorMem)

[byte[]]$WarningIcon = @(137, 80, 78, 71, 13, 10, 26, 10, 0, 0, 0, 13, 73, 72, 68, 82, 0, 0, 0, 22, 0, 0, 0, 20, 8, 6, 0, 0, 0, 137, 124, 205, 48, 0, 0, 0, 6, 98, 75, 71, 68, 0, 255, 0, 255, 0, 255, 160, 189, 167, 147, 0, 0, 0, 9, 112, 72, 89, 115, 0, 0, 11, 19, 0, 0, 11, 19, 1, 0, 154, 156, 24, 0, 0, 0, 7, 116, 73, 77, 69, 7, 224, 7, 6, 1, 44, 23, 246, 251, 182, 176, 0, 0, 4, 60, 73, 68, 65, 84, 56, 203, 165, 148, 125, 104, 213, 85, 24, 199, 63, 231, 247, 122, 239, 157, 155, 94, 183, 166, 37, 76, 66, 9, 140, 102, 105, 234, 12, 138, 88, 70, 217, 11, 150, 164, 232, 31, 21, 68, 88, 84, 212, 31, 253, 145, 36, 248, 151, 161, 5, 145, 189, 65, 22, 65, 127, 4, 26, 68, 16, 164, 97, 161, 249, 178, 185, 185, 237, 178, 185, 23, 117, 237, 110, 77, 157, 49, 157, 187, 154, 187, 111, 191, 123, 127, 191, 115, 158, 254, 216, 180, 68, 147, 162, 135, 115, 206, 243, 156, 135, 115, 62, 231, 123, 30, 14, 7, 110, 98, 195, 167, 70, 1, 24, 29, 205, 212, 118, 119, 119, 108, 74, 165, 218, 62, 236, 233, 29, 242, 0, 154, 143, 180, 243, 191, 173, 239, 248, 240, 230, 161, 95, 191, 148, 129, 19, 159, 75, 103, 231, 201, 212, 149, 252, 75, 27, 158, 255, 239, 176, 182, 182, 54, 0, 210, 67, 227, 203, 251, 79, 30, 24, 31, 63, 253, 168, 100, 134, 23, 75, 103, 106, 119, 246, 72, 235, 224, 51, 0, 34, 242, 143, 251, 173, 27, 37, 63, 251, 116, 59, 13, 13, 13, 0, 136, 206, 111, 174, 240, 246, 85, 251, 222, 101, 252, 88, 156, 234, 138, 175, 19, 142, 19, 110, 216, 253, 195, 177, 74, 165, 20, 135, 155, 58, 110, 8, 86, 55, 74, 22, 75, 66, 220, 87, 156, 232, 191, 248, 84, 220, 235, 248, 106, 70, 124, 75, 50, 230, 130, 24, 69, 20, 186, 156, 30, 91, 85, 40, 68, 171, 55, 53, 44, 157, 251, 209, 191, 86, 220, 210, 210, 78, 220, 87, 12, 164, 51, 243, 226, 177, 252, 198, 184, 247, 77, 210, 115, 13, 217, 188, 34, 155, 179, 48, 90, 83, 51, 173, 35, 161, 72, 175, 61, 212, 124, 170, 14, 32, 149, 74, 93, 7, 118, 254, 62, 25, 28, 28, 96, 254, 252, 59, 0, 136, 197, 102, 174, 183, 217, 181, 120, 122, 229, 32, 103, 71, 92, 190, 253, 222, 39, 44, 219, 172, 108, 44, 176, 112, 193, 40, 151, 242, 29, 247, 137, 204, 121, 13, 216, 184, 100, 201, 146, 155, 43, 190, 2, 29, 27, 147, 229, 98, 154, 215, 196, 189, 22, 223, 177, 133, 124, 1, 82, 157, 66, 115, 171, 98, 34, 107, 240, 221, 144, 100, 226, 152, 101, 73, 122, 221, 193, 67, 93, 141, 0, 123, 247, 238, 187, 121, 41, 250, 251, 197, 45, 20, 71, 87, 199, 221, 163, 247, 248, 206, 40, 98, 44, 108, 11, 162, 168, 76, 46, 31, 80, 85, 161, 208, 198, 33, 230, 252, 206, 244, 216, 209, 185, 158, 239, 175, 217, 186, 229, 3, 127, 229, 202, 135, 249, 228, 227, 247, 174, 7, 247, 246, 246, 1, 96, 59, 19, 245, 142, 234, 126, 204, 81, 61, 136, 41, 35, 218, 194, 177, 45, 140, 46, 81, 44, 4, 196, 253, 28, 97, 233, 50, 86, 52, 65, 165, 117, 0, 223, 106, 125, 185, 113, 229, 250, 167, 1, 94, 127, 99, 227, 181, 224, 174, 174, 110, 234, 235, 239, 162, 35, 149, 78, 58, 246, 185, 87, 93, 213, 87, 239, 200, 111, 40, 227, 161, 195, 50, 182, 206, 16, 133, 89, 10, 65, 128, 203, 5, 202, 185, 243, 4, 249, 12, 118, 41, 77, 133, 254, 201, 150, 242, 241, 117, 45, 109, 23, 231, 92, 129, 182, 183, 183, 79, 130, 23, 45, 186, 27, 128, 234, 234, 228, 131, 202, 12, 191, 104, 235, 131, 216, 202, 16, 22, 207, 17, 229, 206, 162, 244, 4, 81, 24, 16, 20, 242, 36, 60, 133, 137, 44, 16, 11, 145, 24, 211, 72, 145, 176, 186, 87, 139, 57, 243, 68, 83, 107, 191, 11, 176, 108, 217, 178, 191, 74, 209, 211, 123, 166, 46, 40, 140, 188, 226, 209, 132, 71, 154, 96, 226, 60, 81, 49, 139, 142, 4, 215, 86, 88, 18, 160, 172, 50, 113, 15, 76, 4, 162, 193, 104, 133, 173, 243, 196, 194, 195, 184, 50, 252, 172, 194, 154, 117, 205, 115, 235, 31, 40, 56, 70, 95, 88, 235, 72, 223, 35, 118, 240, 29, 161, 42, 97, 116, 132, 194, 194, 24, 72, 120, 134, 199, 27, 29, 238, 205, 40, 60, 219, 80, 10, 20, 98, 64, 12, 40, 113, 168, 208, 93, 20, 88, 254, 64, 64, 213, 170, 131, 71, 199, 119, 16, 244, 26, 11, 96, 34, 155, 169, 45, 7, 67, 47, 248, 229, 93, 216, 209, 31, 232, 146, 6, 109, 33, 26, 36, 130, 98, 30, 170, 42, 125, 230, 204, 178, 25, 207, 216, 40, 17, 68, 3, 145, 194, 104, 7, 75, 7, 84, 148, 246, 16, 115, 131, 119, 117, 241, 196, 130, 98, 33, 167, 236, 238, 158, 180, 135, 100, 223, 244, 194, 221, 107, 170, 204, 143, 136, 113, 64, 166, 20, 9, 184, 74, 232, 58, 25, 99, 219, 142, 4, 77, 41, 168, 77, 122, 44, 189, 179, 72, 80, 180, 65, 51, 181, 206, 195, 13, 71, 40, 202, 12, 31, 127, 97, 221, 67, 43, 86, 236, 180, 194, 114, 190, 134, 112, 232, 173, 120, 121, 15, 132, 96, 34, 11, 137, 38, 149, 74, 168, 208, 145, 162, 42, 161, 153, 93, 27, 163, 122, 230, 52, 110, 171, 46, 19, 5, 54, 68, 83, 135, 107, 64, 3, 166, 146, 25, 185, 157, 216, 102, 228, 201, 230, 35, 109, 207, 169, 253, 191, 252, 188, 181, 198, 219, 255, 246, 45, 229, 247, 193, 170, 68, 148, 32, 74, 0, 153, 108, 2, 34, 134, 179, 163, 46, 229, 200, 226, 246, 91, 67, 44, 81, 147, 121, 163, 192, 0, 90, 33, 70, 97, 83, 36, 227, 223, 79, 169, 102, 251, 136, 99, 41, 251, 82, 46, 90, 136, 147, 216, 134, 101, 251, 216, 142, 141, 109, 91, 83, 221, 190, 234, 231, 213, 9, 198, 24, 34, 45, 136, 158, 140, 181, 54, 24, 109, 48, 198, 96, 180, 32, 162, 9, 35, 159, 160, 112, 89, 59, 201, 100, 205, 23, 198, 36, 205, 249, 75, 179, 231, 26, 145, 178, 178, 20, 10, 133, 82, 160, 212, 164, 159, 28, 0, 4, 49, 83, 145, 76, 221, 8, 185, 250, 225, 27, 17, 85, 85, 89, 21, 78, 140, 141, 189, 243, 39, 118, 67, 49, 224, 62, 186, 148, 71, 0, 0, 0, 0, 73, 69, 78, 68, 174, 66, 96, 130)
$WarningMem = New-Object IO.MemoryStream($WarningIcon, 0, $WarningIcon.Length)
$WarningImage = [System.Drawing.Image]::FromStream($WarningMem)

[byte[]]$InfoIcon = @(137, 80, 78, 71, 13, 10, 26, 10, 0, 0, 0, 13, 73, 72, 68, 82, 0, 0, 0, 22, 0, 0, 0, 22, 8, 6, 0, 0, 0, 196, 180, 108, 59, 0, 0, 0, 6, 98, 75, 71, 68, 0, 255, 0, 255, 0, 255, 160, 189, 167, 147, 0, 0, 0, 9, 112, 72, 89, 115, 0, 0, 11, 19, 0, 0, 11, 19, 1, 0, 154, 156, 24, 0, 0, 0, 7, 116, 73, 77, 69, 7, 224, 7, 6, 1, 43, 50, 242, 190, 244, 48, 0, 0, 5, 135, 73, 68, 65, 84, 56, 203, 85, 149, 77, 140, 149, 87, 25, 199, 127, 207, 115, 206, 251, 190, 247, 206, 157, 11, 243, 61, 195, 87, 156, 41, 31, 3, 45, 29, 70, 8, 149, 166, 136, 64, 140, 88, 67, 74, 234, 210, 133, 145, 216, 38, 70, 23, 70, 195, 198, 157, 11, 211, 68, 67, 26, 163, 141, 11, 67, 210, 164, 26, 173, 46, 90, 149, 133, 105, 2, 1, 41, 212, 148, 150, 182, 180, 212, 14, 5, 156, 129, 139, 211, 249, 158, 59, 115, 191, 223, 143, 115, 92, 220, 233, 24, 23, 207, 234, 228, 252, 243, 59, 191, 231, 156, 231, 8, 128, 247, 158, 103, 14, 237, 228, 252, 219, 119, 1, 152, 46, 77, 154, 185, 185, 197, 160, 187, 175, 183, 175, 188, 90, 59, 217, 108, 37, 219, 81, 131, 17, 193, 90, 227, 138, 157, 249, 43, 253, 221, 27, 46, 205, 205, 47, 248, 237, 59, 118, 53, 68, 4, 128, 201, 201, 41, 70, 70, 134, 249, 232, 163, 91, 72, 165, 229, 41, 70, 237, 5, 128, 91, 239, 93, 43, 6, 249, 141, 95, 159, 93, 73, 78, 151, 155, 122, 98, 174, 130, 254, 167, 156, 81, 139, 193, 168, 48, 216, 29, 49, 50, 16, 49, 216, 41, 116, 119, 200, 239, 187, 58, 204, 217, 153, 210, 253, 137, 235, 229, 129, 214, 243, 39, 70, 185, 121, 243, 67, 246, 237, 27, 99, 61, 209, 123, 103, 74, 247, 62, 217, 51, 189, 84, 127, 126, 98, 214, 61, 119, 163, 228, 59, 110, 220, 79, 88, 172, 2, 8, 161, 85, 188, 247, 52, 83, 71, 96, 60, 219, 7, 34, 142, 63, 190, 129, 47, 141, 68, 211, 35, 189, 246, 183, 113, 163, 254, 242, 240, 206, 221, 15, 62, 207, 91, 15, 190, 127, 231, 214, 163, 15, 151, 154, 175, 92, 156, 136, 15, 92, 188, 237, 89, 169, 67, 20, 8, 206, 121, 182, 246, 132, 28, 218, 221, 69, 185, 154, 240, 230, 191, 202, 164, 30, 146, 212, 147, 57, 207, 232, 150, 144, 111, 61, 217, 205, 190, 205, 250, 155, 164, 81, 249, 233, 206, 199, 198, 231, 1, 196, 123, 207, 39, 31, 190, 219, 191, 80, 77, 127, 126, 225, 118, 118, 250, 141, 9, 197, 59, 48, 10, 222, 67, 154, 101, 188, 120, 122, 148, 47, 63, 214, 71, 146, 57, 94, 124, 237, 14, 175, 92, 153, 163, 187, 51, 192, 123, 136, 83, 79, 255, 70, 195, 119, 143, 20, 227, 241, 45, 230, 199, 213, 242, 226, 185, 241, 39, 158, 106, 233, 159, 126, 119, 78, 43, 205, 236, 212, 237, 89, 127, 250, 194, 167, 130, 91, 11, 5, 112, 222, 83, 8, 133, 98, 14, 178, 52, 6, 151, 176, 165, 55, 32, 78, 221, 122, 79, 194, 64, 152, 91, 201, 248, 203, 141, 106, 120, 119, 166, 121, 198, 70, 249, 157, 222, 223, 197, 252, 242, 87, 47, 245, 78, 78, 175, 188, 252, 183, 91, 174, 103, 122, 69, 201, 217, 182, 31, 1, 84, 132, 102, 236, 89, 169, 54, 112, 105, 194, 7, 255, 46, 243, 234, 213, 89, 82, 44, 70, 21, 81, 65, 68, 48, 70, 152, 93, 117, 244, 21, 165, 107, 115, 151, 132, 243, 51, 141, 11, 246, 225, 244, 236, 87, 231, 107, 236, 248, 120, 70, 232, 8, 4, 240, 235, 52, 8, 136, 17, 38, 62, 139, 89, 168, 44, 144, 100, 158, 213, 196, 82, 200, 27, 156, 115, 164, 153, 195, 57, 240, 120, 226, 204, 243, 246, 84, 202, 222, 65, 121, 238, 222, 123, 255, 248, 158, 77, 82, 119, 234, 211, 121, 112, 222, 160, 248, 118, 172, 0, 34, 24, 17, 86, 91, 158, 147, 227, 5, 70, 135, 44, 169, 19, 206, 93, 92, 230, 157, 187, 203, 132, 10, 206, 101, 56, 239, 241, 222, 227, 60, 92, 253, 44, 227, 27, 59, 187, 57, 254, 244, 201, 111, 219, 48, 10, 158, 189, 51, 215, 36, 50, 33, 126, 237, 142, 168, 40, 170, 66, 16, 88, 42, 11, 117, 10, 54, 102, 176, 0, 113, 170, 184, 184, 73, 189, 158, 32, 161, 224, 188, 7, 239, 219, 56, 62, 163, 92, 201, 88, 105, 40, 165, 135, 211, 187, 109, 154, 100, 209, 106, 3, 84, 64, 4, 84, 13, 170, 66, 150, 121, 230, 231, 43, 204, 205, 84, 169, 87, 61, 245, 122, 70, 234, 218, 170, 2, 163, 24, 21, 196, 129, 23, 135, 247, 190, 189, 89, 160, 22, 11, 75, 139, 75, 98, 85, 141, 55, 70, 4, 17, 84, 21, 60, 172, 172, 54, 169, 148, 235, 120, 231, 176, 214, 144, 180, 18, 234, 141, 140, 52, 51, 120, 15, 86, 3, 212, 120, 84, 61, 222, 43, 206, 57, 192, 97, 140, 193, 42, 136, 8, 22, 184, 183, 185, 203, 236, 152, 175, 41, 73, 156, 178, 188, 92, 167, 213, 136, 49, 198, 16, 4, 150, 192, 42, 113, 28, 83, 175, 123, 82, 167, 224, 3, 140, 53, 24, 117, 180, 77, 120, 68, 4, 239, 132, 156, 133, 66, 144, 50, 56, 216, 47, 90, 171, 174, 190, 62, 182, 53, 199, 194, 74, 147, 249, 185, 85, 226, 102, 130, 181, 22, 107, 12, 170, 6, 99, 116, 77, 141, 35, 142, 99, 192, 99, 140, 197, 26, 139, 49, 102, 173, 20, 135, 176, 169, 39, 160, 24, 38, 12, 13, 12, 188, 165, 155, 134, 250, 207, 111, 41, 166, 104, 92, 165, 21, 187, 53, 26, 69, 180, 237, 81, 69, 137, 114, 17, 249, 92, 158, 92, 148, 195, 26, 139, 53, 138, 49, 138, 209, 118, 169, 26, 18, 111, 216, 63, 146, 163, 175, 104, 106, 165, 82, 233, 162, 166, 113, 235, 157, 77, 93, 97, 233, 196, 88, 39, 169, 87, 4, 65, 84, 80, 149, 118, 35, 69, 137, 162, 136, 124, 62, 71, 46, 151, 39, 176, 1, 70, 215, 78, 163, 6, 85, 197, 35, 116, 23, 45, 7, 71, 32, 167, 201, 11, 205, 70, 173, 161, 2, 201, 134, 60, 63, 250, 218, 88, 33, 25, 27, 201, 209, 74, 65, 215, 40, 84, 21, 239, 161, 179, 144, 167, 167, 171, 147, 158, 141, 5, 194, 208, 34, 162, 24, 109, 107, 80, 49, 136, 40, 71, 247, 4, 108, 239, 73, 31, 4, 234, 95, 61, 245, 236, 55, 19, 29, 251, 226, 129, 172, 213, 168, 253, 125, 164, 223, 252, 250, 59, 71, 55, 176, 107, 91, 142, 74, 211, 163, 34, 168, 8, 129, 129, 185, 114, 198, 131, 5, 199, 195, 37, 71, 61, 246, 4, 214, 96, 85, 201, 156, 18, 59, 225, 216, 222, 28, 199, 119, 185, 86, 193, 38, 103, 60, 105, 233, 255, 198, 230, 173, 155, 215, 7, 155, 137, 254, 100, 190, 17, 253, 240, 181, 119, 91, 188, 241, 126, 133, 66, 20, 18, 24, 101, 91, 175, 161, 35, 18, 64, 89, 168, 64, 51, 181, 84, 155, 9, 133, 14, 207, 169, 253, 150, 199, 251, 171, 213, 222, 2, 103, 195, 208, 158, 61, 112, 240, 201, 26, 128, 220, 252, 224, 6, 251, 198, 15, 180, 191, 150, 187, 19, 125, 203, 43, 213, 31, 164, 18, 157, 41, 85, 242, 157, 127, 190, 182, 200, 199, 165, 20, 136, 8, 205, 154, 26, 21, 10, 249, 140, 195, 163, 150, 195, 143, 56, 162, 172, 220, 176, 226, 190, 223, 217, 145, 251, 227, 254, 131, 135, 90, 34, 194, 207, 126, 113, 182, 77, 124, 229, 202, 101, 142, 28, 57, 10, 192, 249, 191, 190, 174, 91, 183, 109, 251, 138, 136, 121, 161, 163, 179, 184, 55, 150, 124, 248, 112, 41, 14, 151, 42, 9, 86, 161, 127, 131, 208, 147, 115, 105, 181, 188, 176, 220, 168, 215, 255, 208, 215, 215, 251, 210, 253, 210, 244, 228, 169, 103, 78, 102, 0, 83, 83, 83, 12, 15, 15, 255, 79, 197, 204, 204, 12, 67, 67, 67, 0, 92, 189, 246, 150, 60, 117, 112, 92, 46, 95, 251, 231, 23, 234, 245, 250, 19, 3, 125, 125, 135, 141, 209, 206, 52, 203, 104, 54, 91, 213, 106, 173, 113, 117, 228, 145, 225, 235, 123, 118, 63, 58, 249, 249, 3, 185, 116, 233, 50, 199, 142, 29, 93, 31, 140, 255, 5, 247, 135, 142, 209, 58, 237, 175, 80, 0, 0, 0, 0, 73, 69, 78, 68, 174, 66, 96, 130)
$InfoMem = New-Object IO.MemoryStream($InfoIcon, 0, $InfoIcon.Length)
$InfoImage = [System.Drawing.Image]::FromStream($InfoMem)



# Set up the form  ============================================================

[void] [System.Reflection.Assembly]::LoadWithPartialName("System.Windows.Forms")
[void] [System.Reflection.Assembly]::LoadWithPartialName("System.Drawing") 

$objForm = New-Object System.Windows.Forms.Form 
$objForm.Text = "Skype4B / Lync Centralised Event Viewer Tool v1.00"
$objForm.Size = New-Object System.Drawing.Size(900,570) 
$objForm.MinimumSize = New-Object System.Drawing.Size(860,340) 
$objForm.StartPosition = "CenterScreen"
[byte[]]$WindowIcon = @(66, 77, 56, 3, 0, 0, 0, 0, 0, 0, 54, 0, 0, 0, 40, 0, 0, 0, 16, 0, 0, 0, 16, 0, 0, 0, 1, 0, 24, 0, 0, 0, 0, 0, 2, 3, 0, 0, 18, 11, 0, 0, 18, 11, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114,0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0,198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 205, 132, 32, 234, 202, 160,255, 255, 255, 244, 229, 208, 205, 132, 32, 202, 123, 16, 248, 238, 224, 198, 114, 0, 205, 132, 32, 234, 202, 160, 255,255, 255, 255, 255, 255, 244, 229, 208, 219, 167, 96, 198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 248, 238, 224, 198, 114, 0, 198, 114, 0, 223, 176, 112, 255, 255, 255, 219, 167, 96, 198, 114, 0, 198, 114, 0, 255, 255, 255, 255, 255, 255, 227, 185, 128, 198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 241, 220, 192, 198, 114, 0, 198,114, 0, 248, 238, 224, 255, 255, 255, 244, 229, 208, 198, 114, 0, 198, 114, 0, 255, 255, 255, 255, 255, 255, 227, 185, 128, 198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 241, 220, 192, 198, 114, 0, 216, 158, 80, 255, 255, 255, 255, 255, 255, 252, 247, 240, 209, 141, 48, 198, 114, 0, 255, 255, 255, 255, 255, 255, 227, 185, 128, 198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 241, 220, 192, 198, 114, 0, 241, 220, 192, 255, 255, 255, 252, 247, 240, 212, 149, 64, 234, 202, 160, 198, 114, 0, 255, 255, 255, 255, 255, 255, 227, 185, 128, 198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 241, 220, 192, 205, 132, 32, 255, 255, 255, 255, 255, 255, 227, 185, 128, 198, 114, 0, 248, 238, 224, 202, 123, 16, 255, 255, 255, 255, 255, 255, 227, 185, 128, 198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 241, 220, 192, 234, 202, 160, 255, 255, 255, 255, 255, 255, 205, 132, 32, 198, 114, 0, 223, 176, 112, 223, 176, 112, 255, 255, 255, 255, 255, 255, 227, 185, 128, 198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 244, 229, 208, 252, 247, 240, 255, 255, 255, 237, 211, 176, 198, 114, 0, 198, 114, 0, 202, 123, 16, 248, 238, 224, 255, 255, 255, 255, 255, 255, 227, 185, 128, 198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 212, 149, 64, 255, 255, 255, 255, 255, 255, 255, 255, 255, 212, 149, 64, 198, 114, 0, 198, 114, 0, 198, 114, 0, 234, 202, 160, 255, 255,255, 255, 255, 255, 241, 220, 192, 205, 132, 32, 198, 114, 0, 198, 114, 0, 205, 132, 32, 227, 185, 128, 227, 185, 128, 227, 185, 128, 227, 185, 128, 198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 205, 132, 32, 227, 185, 128, 227, 185,128, 227, 185, 128, 219, 167, 96, 198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 0, 0)
$ico = New-Object IO.MemoryStream($WindowIcon, 0, $WindowIcon.Length)
$objForm.Icon = [System.Drawing.Icon]::FromHandle((new-object System.Drawing.Bitmap -argument $ico).GetHIcon())
$objForm.KeyPreview = $True
$objForm.TabStop = $false


$MyLinkLabel = New-Object System.Windows.Forms.LinkLabel
$MyLinkLabel.Location = New-Object System.Drawing.Size(690,5)
$MyLinkLabel.Size = New-Object System.Drawing.Size(180,15)
$MyLinkLabel.DisabledLinkColor = [System.Drawing.Color]::Red
$MyLinkLabel.VisitedLinkColor = [System.Drawing.Color]::Blue
$MyLinkLabel.LinkBehavior = [System.Windows.Forms.LinkBehavior]::HoverUnderline
$MyLinkLabel.LinkColor = [System.Drawing.Color]::Navy
$MyLinkLabel.TabStop = $False
$MyLinkLabel.Text = "Created by: www.myskypelab.com"
$MyLinkLabel.Anchor = [System.Windows.Forms.AnchorStyles]::Right -bor [System.Windows.Forms.AnchorStyles]::Top
$MyLinkLabel.add_click(
{
	 [system.Diagnostics.Process]::start("http://www.myskypelab.com")
})
$objForm.Controls.Add($MyLinkLabel)



#$Network Label ============================================================
$StartTimeLabel = New-Object System.Windows.Forms.Label
$StartTimeLabel.Location = New-Object System.Drawing.Size(30,30) 
$StartTimeLabel.Size = New-Object System.Drawing.Size(35,15) 
$StartTimeLabel.Text = "Start: "
$StartTimeLabel.TabStop = $false
$StartTimeLabel.Anchor = [System.Windows.Forms.AnchorStyles]::Left -bor [System.Windows.Forms.AnchorStyles]::Top
$objForm.Controls.Add($StartTimeLabel)


$StartTimePicker = New-Object System.Windows.Forms.DateTimePicker
$StartTimePicker.Format = [System.Windows.Forms.DateTimePickerFormat]::Custom
$StartTimePicker.CustomFormat = "yy/MM/dd HH:mm";
$StartTimePicker.ShowUpDown = $true
$StartTimePicker.Location = New-Object Drawing.Size(65,27)
$StartTimePicker.Width = 110
$StartTimePicker.tabIndex = 1
$StartTimePicker.Value = (Get-Date) - (New-TimeSpan -Hour 6)
$objForm.Controls.Add($StartTimePicker)

#$Network Label ============================================================
$EndTimeLabel = New-Object System.Windows.Forms.Label
$EndTimeLabel.Location = New-Object System.Drawing.Size(35,57) 
$EndTimeLabel.Size = New-Object System.Drawing.Size(30,15) 
$EndTimeLabel.Text = "End: "
$EndTimeLabel.TabStop = $false
$EndTimeLabel.Anchor = [System.Windows.Forms.AnchorStyles]::Left -bor [System.Windows.Forms.AnchorStyles]::Top
$objForm.Controls.Add($EndTimeLabel)


$EndTimePicker = New-Object System.Windows.Forms.DateTimePicker
$EndTimePicker.Format = [System.Windows.Forms.DateTimePickerFormat]::Custom
$EndTimePicker.CustomFormat = "yy/MM/dd HH:mm";
$EndTimePicker.ShowUpDown = $true
$EndTimePicker.Location = New-Object Drawing.Size(65,53)
$EndTimePicker.Width = 110
$EndTimePicker.tabIndex = 2
$objForm.Controls.Add($EndTimePicker)


#Server Label ============================================================
$ServerLabel = New-Object System.Windows.Forms.Label
$ServerLabel.Location = New-Object System.Drawing.Size(185,28) 
$ServerLabel.Size = New-Object System.Drawing.Size(55,15) 
$ServerLabel.Text = "Server(s): "
$ServerLabel.TabStop = $false
$ServerLabel.Anchor = [System.Windows.Forms.AnchorStyles]::Left -bor [System.Windows.Forms.AnchorStyles]::Top
$objForm.Controls.Add($ServerLabel)


#Server Drop Down box ============================================================
$ServerTextBox = New-Object System.Windows.Forms.ComboBox 
$ServerTextBox.Location = New-Object System.Drawing.Size(240,25) 
$ServerTextBox.Size = New-Object System.Drawing.Size(235,15) 
$ServerTextBox.DropDownHeight = 500 
$ServerTextBox.DropDownWidth = 400 
$ServerTextBox.DropDownStyle = [System.Windows.Forms.ComboBoxStyle]::DropDownList
$ServerTextBox.tabIndex = 3
$ServerTextBox.Sorted = $true
$ServerTextBox.Anchor = [System.Windows.Forms.AnchorStyles]::Left -bor [System.Windows.Forms.AnchorStyles]::Top
$objForm.Controls.Add($ServerTextBox) 

$computers = @()
Get-CsPool | where-object {$_.Services -like "Registrar*" -or $_.Services -like "EdgeServer*" -or $_.Services -like "PersistentChatServer*"} | select-object Computers | ForEach-Object {$computers +=  $_.Computers}
Get-CsPool | where-object {$_.Services -like "Registrar*" -or $_.Services -like "EdgeServer*" -or $_.Services -like "PersistentChatServer*"} | select-object Identity | ForEach-Object {$computers +=  "Pool:"+$_.Identity}

[void] $ServerTextBox.Items.Add("ALL FRONTENDS")
[void] $ServerTextBox.Items.Add("ALL SERVERS")	
foreach($computer in $computers)
{
	[void] $ServerTextBox.Items.Add($computer)
}
$ServerTextBox.SelectedIndex = $ServerTextBox.FindStringExact("ALL FRONTENDS")



#EventIDLabel Label ============================================================
$EventIDLabel2 = New-Object System.Windows.Forms.Label
$EventIDLabel2.Location = New-Object System.Drawing.Size(185,50) 
$EventIDLabel2.Size = New-Object System.Drawing.Size(45,15) 
$EventIDLabel2.Text = "Include"
$EventIDLabel2.TabStop = $false
$EventIDLabel2.Anchor = [System.Windows.Forms.AnchorStyles]::Left -bor [System.Windows.Forms.AnchorStyles]::Top
$objForm.Controls.Add($EventIDLabel2)

#EventIDLabel Label ============================================================
$EventIDLabel = New-Object System.Windows.Forms.Label
$EventIDLabel.Location = New-Object System.Drawing.Size(185,65) 
$EventIDLabel.Size = New-Object System.Drawing.Size(52,15) 
$EventIDLabel.Text = "Event ID: "
$EventIDLabel.TabStop = $false
$EventIDLabel.Anchor = [System.Windows.Forms.AnchorStyles]::Left -bor [System.Windows.Forms.AnchorStyles]::Top
$objForm.Controls.Add($EventIDLabel)



#EventIDLabel Text box ============================================================
$EventIDTextBox = New-Object System.Windows.Forms.TextBox 
$EventIDTextBox.Location = New-Object System.Drawing.Size(240,55) 
$EventIDTextBox.Size = New-Object System.Drawing.Size(80,15) 
$EventIDTextBox.tabIndex = 4
$EventIDTextBox.Anchor = [System.Windows.Forms.AnchorStyles]::Left -bor [System.Windows.Forms.AnchorStyles]::Top
$objForm.Controls.Add($EventIDTextBox) 


#EventIDLabel Label ============================================================
$EventIDExcludeLabel2 = New-Object System.Windows.Forms.Label
$EventIDExcludeLabel2.Location = New-Object System.Drawing.Size(340,50) 
$EventIDExcludeLabel2.Size = New-Object System.Drawing.Size(45,15) 
$EventIDExcludeLabel2.Text = "Exclude"
$EventIDExcludeLabel2.TabStop = $false
$EventIDExcludeLabel2.Anchor = [System.Windows.Forms.AnchorStyles]::Left -bor [System.Windows.Forms.AnchorStyles]::Top
$objForm.Controls.Add($EventIDExcludeLabel2)

#EventIDLabel Label ============================================================
$EventIDExcludeLabel = New-Object System.Windows.Forms.Label
$EventIDExcludeLabel.Location = New-Object System.Drawing.Size(340,65) 
$EventIDExcludeLabel.Size = New-Object System.Drawing.Size(52,15) 
$EventIDExcludeLabel.Text = "Event ID: "
$EventIDExcludeLabel.TabStop = $false
$EventIDExcludeLabel.Anchor = [System.Windows.Forms.AnchorStyles]::Left -bor [System.Windows.Forms.AnchorStyles]::Top
$objForm.Controls.Add($EventIDExcludeLabel)



#EventIDLabel Text box ============================================================
$EventIDExcludeTextBox = New-Object System.Windows.Forms.TextBox 
$EventIDExcludeTextBox.Location = New-Object System.Drawing.Size(395,55) 
$EventIDExcludeTextBox.Size = New-Object System.Drawing.Size(80,15) 
$EventIDExcludeTextBox.tabIndex = 5
$EventIDExcludeTextBox.Anchor = [System.Windows.Forms.AnchorStyles]::Left -bor [System.Windows.Forms.AnchorStyles]::Top
$objForm.Controls.Add($EventIDExcludeTextBox) 


#Find Previous button
$FindPreviousButton = New-Object System.Windows.Forms.Button
$FindPreviousButton.Location = New-Object System.Drawing.Size(480,85)
$FindPreviousButton.Size = New-Object System.Drawing.Size(120,20)
$FindPreviousButton.Text = "<- Find Previous"
$FindPreviousButton.tabIndex = 13
$FindPreviousButton.Anchor = [System.Windows.Forms.AnchorStyles]::Right -bor [System.Windows.Forms.AnchorStyles]::Top
$FindPreviousButton.Add_Click(
{
	$StatusLabel.Text = ""
	[string]$FindString = $FindNextTextBox.Text
	$selectedRowCount = $dgv.SelectedRows[0].Index
	$selectedRowCount = $selectedRowCount - 1
	$WasFound = $false
	for($i=$selectedRowCount; $i -ge 0; $i--)
	{
		for($j=1; $j -lt 7; $j++)
		{
			$cellstr = $dgv.Rows[$i].Cells[$j].Value.ToString()
			
			if($cellstr -ne $null)
			{
				if($cellstr -match $FindString)
				{
					$WasFound = $true
				}
			}
		}
		if($WasFound)
		{
			$dgv.Rows[$i].Selected = $true
			$dgv.FirstDisplayedScrollingRowIndex = $i
			Write-Host "Found Search String at row: $i" -foreground "green"
			break
		}
	}
	if(!$WasFound)
	{
		Write-Host "Search string was not found" -foreground "red"
		$StatusLabel.Text = "Search string was not found"
	}
	[System.Windows.Forms.Application]::DoEvents()
})
$objForm.Controls.Add($FindPreviousButton)


#FindNext Text box ============================================================
$FindNextTextBox = New-Object System.Windows.Forms.TextBox 
$FindNextTextBox.Location = New-Object System.Drawing.Size(610,85) 
$FindNextTextBox.Size = New-Object System.Drawing.Size(120,15) 
$FindNextTextBox.tabIndex = 11
$FindNextTextBox.Anchor = [System.Windows.Forms.AnchorStyles]::Right -bor [System.Windows.Forms.AnchorStyles]::Top
$objForm.Controls.Add($FindNextTextBox)
$FindNextTextBox.add_KeyUp(
{
	if ($_.KeyCode -eq "Enter") 
	{
		#FIND NEXT
		$StatusLabel.Text = ""
		[string]$FindString = $FindNextTextBox.Text
		$selectedRowCount = $dgv.SelectedRows[0].Index
		$selectedRowCount = $selectedRowCount + 1
		$WasFound = $false
		for($i=$selectedRowCount; $i -lt $dgv.Rows.Count; $i++)
		{
			for($j=1; $j -lt 7; $j++)
			{
				$cellstr = $dgv.Rows[$i].Cells[$j].Value.ToString()
				
				if($cellstr -ne $null)
				{
					if($cellstr -match $FindString)
					{
						$WasFound = $true
					}
				}
			}
			if($WasFound)
			{
				$dgv.Rows[$i].Selected = $true
				$dgv.FirstDisplayedScrollingRowIndex = $i
				Write-Host "Found Search String at row: $i" -foreground "green"
				break
			}
		}
		if(!$WasFound)
		{
			Write-Host "Search string was not found" -foreground "red"
			$StatusLabel.Text = "Search string was not found"
		}
		[System.Windows.Forms.Application]::DoEvents()
	}
})


#Find Next button
$FindNextButton = New-Object System.Windows.Forms.Button
$FindNextButton.Location = New-Object System.Drawing.Size(740,85)
$FindNextButton.Size = New-Object System.Drawing.Size(120,20)
$FindNextButton.Text = "Find Next ->"
$FindNextButton.tabIndex = 12
$FindNextButton.Anchor = [System.Windows.Forms.AnchorStyles]::Right -bor [System.Windows.Forms.AnchorStyles]::Top
$FindNextButton.Add_Click(
{
	$StatusLabel.Text = ""
	[string]$FindString = $FindNextTextBox.Text
	$selectedRowCount = $dgv.SelectedRows[0].Index
	$selectedRowCount = $selectedRowCount + 1
	$WasFound = $false
	for($i=$selectedRowCount; $i -lt $dgv.Rows.Count; $i++)
	{
		for($j=1; $j -lt 7; $j++)
		{
			$cellstr = $dgv.Rows[$i].Cells[$j].Value.ToString()
			
			if($cellstr -ne $null)
			{
				if($cellstr -match $FindString)
				{
					$WasFound = $true
				}
			}
		}
		if($WasFound)
		{
			$dgv.Rows[$i].Selected = $true
			$dgv.FirstDisplayedScrollingRowIndex = $i
			Write-Host "Found Search String at row: $i" -foreground "green"
			break
		}
	}
	if(!$WasFound)
	{
		Write-Host "Search string was not found" -foreground "red"
		$StatusLabel.Text = "Search string was not found"
	}
	[System.Windows.Forms.Application]::DoEvents()
})
$objForm.Controls.Add($FindNextButton)



#CriticalCheckBox ============================================================
$CriticalCheckBox = New-Object System.Windows.Forms.Checkbox 
$CriticalCheckBox.Location = New-Object System.Drawing.Size(500,30) 
$CriticalCheckBox.Size = New-Object System.Drawing.Size(20,20)
$CriticalCheckBox.TabIndex = 6
$CriticalCheckBox.Add_Click({
	#Does nothing
})
$objForm.Controls.Add($CriticalCheckBox) 
$CriticalCheckBox.Checked = $true

#CriticalLabel ============================================================
$CriticalLabel = New-Object System.Windows.Forms.Label
$CriticalLabel.Location = New-Object System.Drawing.Size(520,32) 
$CriticalLabel.Size = New-Object System.Drawing.Size(60,15) 
$CriticalLabel.Text = "Critical"
$CriticalLabel.TabStop = $false
$CriticalLabel.Add_Click({
	if($CriticalCheckBox.Checked)
	{
		$CriticalCheckBox.Checked = $false
	}
	else
	{
		$CriticalCheckBox.Checked = $true
	}
})
$objForm.Controls.Add($CriticalLabel)

#ErrorCheckBox ============================================================
$ErrorCheckBox = New-Object System.Windows.Forms.Checkbox 
$ErrorCheckBox.Location = New-Object System.Drawing.Size(500,55) 
$ErrorCheckBox.Size = New-Object System.Drawing.Size(20,20)
$ErrorCheckBox.TabIndex = 7
$ErrorCheckBox.Add_Click({
	#Does nothing
})
$objForm.Controls.Add($ErrorCheckBox) 
$ErrorCheckBox.Checked = $true

#Error Label ============================================================
$ErrorLabel = New-Object System.Windows.Forms.Label
$ErrorLabel.Location = New-Object System.Drawing.Size(520,57) 
$ErrorLabel.Size = New-Object System.Drawing.Size(60,15) 
$ErrorLabel.Text = "Error"
$ErrorLabel.TabStop = $false
$ErrorLabel.Add_Click({
	if($ErrorCheckBox.Checked)
	{
		$ErrorCheckBox.Checked = $false
	}
	else
	{
		$ErrorCheckBox.Checked = $true
	}
})
$objForm.Controls.Add($ErrorLabel)



#WarningCheckBox ============================================================
$WarningCheckBox = New-Object System.Windows.Forms.Checkbox 
$WarningCheckBox.Location = New-Object System.Drawing.Size(580,30) 
$WarningCheckBox.Size = New-Object System.Drawing.Size(20,20)
$WarningCheckBox.TabIndex = 8
$WarningCheckBox.Add_Click({
	#Does nothing
})
$objForm.Controls.Add($WarningCheckBox) 
$WarningCheckBox.Checked = $true

#Warning Label ============================================================
$WarningLabel = New-Object System.Windows.Forms.Label
$WarningLabel.Location = New-Object System.Drawing.Size(600,32) 
$WarningLabel.Size = New-Object System.Drawing.Size(60,15) 
$WarningLabel.Text = "Warning"
$WarningLabel.TabStop = $false
$WarningLabel.Add_Click({
	if($WarningCheckBox.Checked)
	{
		$WarningCheckBox.Checked = $false
	}
	else
	{
		$WarningCheckBox.Checked = $true
	}
})
$objForm.Controls.Add($WarningLabel)



#$InformationCheckBox ============================================================
$InformationCheckBox = New-Object System.Windows.Forms.Checkbox 
$InformationCheckBox.Location = New-Object System.Drawing.Size(580,55) 
$InformationCheckBox.Size = New-Object System.Drawing.Size(20,20)
$InformationCheckBox.TabIndex = 9
$InformationCheckBox.Add_Click({
	#Does nothing
})
$objForm.Controls.Add($InformationCheckBox) 
$InformationCheckBox.Checked = $false

#$InformationLabel ============================================================
$InformationLabel = New-Object System.Windows.Forms.Label
$InformationLabel.Location = New-Object System.Drawing.Size(600,57) 
$InformationLabel.Size = New-Object System.Drawing.Size(80,15) 
$InformationLabel.Text = "Information"
$InformationLabel.TabStop = $false
$InformationLabel.Add_Click({
	if($InformationCheckBox.Checked)
	{
		$InformationCheckBox.Checked = $false
	}
	else
	{
		$InformationCheckBox.Checked = $true
	}
})
$objForm.Controls.Add($InformationLabel)


$CancelDiscoverButton = New-Object System.Windows.Forms.Button
$CancelDiscoverButton.Location = New-Object System.Drawing.Size(700,38)
$CancelDiscoverButton.Size = New-Object System.Drawing.Size(120,25)
$CancelDiscoverButton.Text = "CANCEL SCAN..."
$CancelDiscoverButton.ForeColor = "red"
$CancelDiscoverButton.Visible = $false
$CancelDiscoverButton.Add_Click(
{
	$script:CancelScan = $true
	$CancelDiscoverButton.Enabled = $false
	$FilterButton.Enabled = $true
	$FindPreviousButton.Enabled = $true
	$CopyButton.Enabled = $true
	$FindNextButton.Enabled = $true
	$SearchButton.Enabled = $true
	$ExportButton.Enabled = $true
	$ExportStatsButton.Enabled = $true
	$dgv.Enabled = $true
	[System.Windows.Forms.Application]::DoEvents()
}
)
$objForm.Controls.Add($CancelDiscoverButton)


#Filter button ============================================================
$FilterButton = New-Object System.Windows.Forms.Button
$FilterButton.Location = New-Object System.Drawing.Size(700,38)
$FilterButton.Size = New-Object System.Drawing.Size(120,25)
$FilterButton.Text = "Get Events"
$FilterButton.tabIndex = 10
$FilterButton.Anchor = [System.Windows.Forms.AnchorStyles]::Left -bor [System.Windows.Forms.AnchorStyles]::Top
$FilterButton.Add_Click(
{
	$StatusLabel.Text = "Please Wait..."
	$FilterButton.Text = "Getting Logs"
	$FilterButton.Enabled = $false
	$FindPreviousButton.Enabled = $false
	$CopyButton.Enabled = $false
	$FindNextButton.Enabled = $false
	$SearchButton.Enabled = $false
	$ExportButton.Enabled = $false
	$ExportStatsButton.Enabled = $false
	$dgv.Enabled = $false
	$CancelDiscoverButton.Visible = $true
	$ViewEventButton.Enabled = $false
	[System.Windows.Forms.Application]::DoEvents()
	Get-ErrorLog
	$FilterButton.Enabled = $true
	$FindPreviousButton.Enabled = $true
	$CopyButton.Enabled = $true
	$FindNextButton.Enabled = $true
	$SearchButton.Enabled = $true
	$ExportButton.Enabled = $true
	$ExportStatsButton.Enabled = $true
	$ViewEventButton.Enabled = $true
	$dgv.Enabled = $true
	$FilterButton.Text = "Get Events"
	$StatusLabel.Text = ""
	
	if($dgv.Rows.Count > 0)
	{
		$dgv.Rows[0].Selected = $true
		$dgv.FirstDisplayedScrollingRowIndex = $i
	}
	
	$CancelDiscoverButton.Visible = $false
		
	[System.Windows.Forms.Application]::DoEvents()
})
$objForm.Controls.Add($FilterButton)


# Add a groupbox ============================================================
$GroupsBox = New-Object System.Windows.Forms.Groupbox
$GroupsBox.Location = New-Object System.Drawing.Size(25,15) 
$GroupsBox.Size = New-Object System.Drawing.Size(850,67) 
$GroupsBox.Anchor = [System.Windows.Forms.AnchorStyles]::Top -bor [System.Windows.Forms.AnchorStyles]::Right -bor [System.Windows.Forms.AnchorStyles]::Left
$GroupsBox.TabStop = $False
$objForm.Controls.Add($GroupsBox)


#Search button ============================================================
$SearchButton = New-Object System.Windows.Forms.Button
$SearchButton.Location = New-Object System.Drawing.Size(30,480)
$SearchButton.Size = New-Object System.Drawing.Size(100,20)
$SearchButton.Text = "Web Search!"
$SearchButton.tabIndex = 14
$SearchButton.Anchor = [System.Windows.Forms.AnchorStyles]::Left -bor [System.Windows.Forms.AnchorStyles]::Bottom
$SearchButton.Add_Click(
{
	$StatusLabel.Text = "Searching for Error..."

	$selectedRowCount = $dgv.Rows.GetRowCount([System.Windows.Forms.DataGridViewElementStates]::Selected)
	Write-Host "$selectedRowCount Selected Rows..."
    $searchText = ""
	if ($selectedRowCount -gt 0)
    {
        for($i=0; $i -lt $selectedRowCount; $i++)
        {
			[string]$searchText = $dgv.SelectedRows[$i].Cells[3].Value  + " " + $dgv.SelectedRows[$i].Cells[4].Value
        }
    }
	
    if ( ($searchText -ne $null) -and ($searchText -ne '') ) {
	
		if($SearchTextBox.SelectedItem.ToString() -eq "Google")
		{
			$searchText = $searchText.Replace(" ", "+")
			$SearchString = "https://www.google.com/webhp?sourceid=chrome-instant&ion=1&espv=2&ie=UTF-8#q=Event+ID+${searchText}+Lync+Skype+for+Business"
		}
		elseif($SearchTextBox.SelectedItem.ToString() -eq "TechNet")
		{
			$searchText = $searchText.Replace(" ", "+")
			$SearchString = "https://social.technet.microsoft.com/Forums/en-US/home?sort=relevancedesc&brandIgnore=True&searchTerm=Event+ID+${searchText}+Lync+Skype+for+Business"
		}
		elseif($SearchTextBox.SelectedItem.ToString() -eq "Bing")
		{
			$searchText = $searchText.Replace(" ", "+")
			$SearchString = "https://www.bing.com/search?q=Event+ID+${searchText}+Lync+Skype+for+Business"
		}
		elseif($SearchTextBox.SelectedItem.ToString() -eq "Duck Duck Go")
		{
			$searchText = $searchText.Replace(" ", "+")
			$SearchString = "https://www.duckduckgo.com/?q=Event+ID+${searchText}+Lync+Skype+for+Business"
		}
		
		[system.Diagnostics.Process]::start($SearchString) 
	}
	$StatusLabel.Text = ""
})
$objForm.Controls.Add($SearchButton)


#Search Drop Down box ============================================================
$SearchTextBox = New-Object System.Windows.Forms.ComboBox 
$SearchTextBox.Location = New-Object System.Drawing.Size(150,480) 
$SearchTextBox.Size = New-Object System.Drawing.Size(150,15) 
$SearchTextBox.DropDownHeight = 100 
$SearchTextBox.DropDownWidth = 150 
$SearchTextBox.DropDownStyle = [System.Windows.Forms.ComboBoxStyle]::DropDown
$SearchTextBox.tabIndex = 15
$SearchTextBox.Sorted = $false
$SearchTextBox.Anchor = [System.Windows.Forms.AnchorStyles]::Left -bor [System.Windows.Forms.AnchorStyles]::Bottom
$objForm.Controls.Add($SearchTextBox) 

[void] $SearchTextBox.Items.Add("Google")
[void] $SearchTextBox.Items.Add("TechNet")	
[void] $SearchTextBox.Items.Add("Bing")
[void] $SearchTextBox.Items.Add("Duck Duck Go")

$SearchTextBox.SelectedIndex = $SearchTextBox.FindStringExact("Google")


#Open in viewing window ============================================================
$ViewEventButton = New-Object System.Windows.Forms.Button
$ViewEventButton.Location = New-Object System.Drawing.Size(390,480)
$ViewEventButton.Size = New-Object System.Drawing.Size(100,20)
$ViewEventButton.Text = "View Event"
$ViewEventButton.tabIndex = 16
$ViewEventButton.Anchor = [System.Windows.Forms.AnchorStyles]::Right -bor [System.Windows.Forms.AnchorStyles]::Bottom
$ViewEventButton.Add_Click(
{
	$StatusLabel.Text = "View Event..."
		
	$selectedRowCount = $dgv.Rows.GetRowCount([System.Windows.Forms.DataGridViewElementStates]::Selected)
    $theText = ""
	if ($selectedRowCount -gt 0)
    {
        for($i=0; $i -lt $selectedRowCount; $i++)
        {
			$row = $dgv.SelectedRows[$i].Index.ToString()
			[string]$theText = $dgv.SelectedRows[$i].Cells[2].Value + " - " + $dgv.SelectedRows[$i].Cells[3].Value  + " - " + $dgv.SelectedRows[$i].Cells[4].Value  + " - " + $dgv.SelectedRows[$i].Cells[5].Value + "`r`n`r`n"
            $EventText = $dgv.SelectedRows[$i].Cells[6].Value
			$EventText = $EventText.Replace("`n","`r`n")
			[string]$theText += $EventText
			[string]$theText += "`r`n" 
        }
    }
	
	[string]$clipText = $theText
	
	#OPEN TEXT
	MessageView -Message $clipText -WindowTitle "Event View" -DefaultText "Event View"

	$StatusLabel.Text = ""
})
$objForm.Controls.Add($ViewEventButton)

#Copy button ============================================================
$CopyButton = New-Object System.Windows.Forms.Button
$CopyButton.Location = New-Object System.Drawing.Size(500,480)
$CopyButton.Size = New-Object System.Drawing.Size(100,20)
$CopyButton.Text = "Copy"
$CopyButton.tabIndex = 17
$CopyButton.Anchor = [System.Windows.Forms.AnchorStyles]::Right -bor [System.Windows.Forms.AnchorStyles]::Bottom
$CopyButton.Add_Click(
{
	$StatusLabel.Text = "Copying..."
	[Windows.Forms.Clipboard]::Clear()
	
	
	$selectedRowCount = $dgv.Rows.GetRowCount([System.Windows.Forms.DataGridViewElementStates]::Selected)
    $theText = ""
	if ($selectedRowCount -gt 0)
    {
        for($i=0; $i -lt $selectedRowCount; $i++)
        {
			$row = $dgv.SelectedRows[$i].Index.ToString()
			[string]$theText = $dgv.SelectedRows[$i].Cells[2].Value + " - " + $dgv.SelectedRows[$i].Cells[3].Value  + " - " + $dgv.SelectedRows[$i].Cells[4].Value  + " - " + $dgv.SelectedRows[$i].Cells[5].Value + "`r`n`r`n"
			[string]$theText += $dgv.SelectedRows[$i].Cells[6].Value
			[string]$theText += "`r`n" 
        }
    }
	
	[string]$clipText = $theText
	
    if ( ($clipText -ne $null) -and ($clipText -ne '') ) {
            [Windows.Forms.Clipboard]::SetText( $clipText )
	}
	$StatusLabel.Text = ""
})
$objForm.Controls.Add($CopyButton)



#Export Stats button ============================================================
$ExportStatsButton = New-Object System.Windows.Forms.Button
$ExportStatsButton.Location = New-Object System.Drawing.Size(610,480)
$ExportStatsButton.Size = New-Object System.Drawing.Size(120,20)
$ExportStatsButton.Text = "Export Stats"
$ExportStatsButton.tabIndex = 18
$ExportStatsButton.Anchor = [System.Windows.Forms.AnchorStyles]::Right -bor [System.Windows.Forms.AnchorStyles]::Bottom
$ExportStatsButton.Add_Click(
{
	$filename = ""
	
	$StatusLabel.Text = "Please Wait... Exporting Stats"
	$FilterButton.Enabled = $false
	$dgv.Enabled = $false
	$ExportButton.Enabled = $false
	$FilterButton.Enabled = $false
	$FindPreviousButton.Enabled = $false
	$CopyButton.Enabled = $false
	$FindNextButton.Enabled = $false
	$SearchButton.Enabled = $false
	$ExportStatsButton.Enabled = $false
	$ViewEventButton.Enabled = $false
	[System.Windows.Forms.Application]::DoEvents()
	
	#Get the start and end date
	$StartDate = ($StartTimePicker.Value.ToString("yyyy.MM.dd_HH.mm"))
	$EndDate = ($EndTimePicker.Value.ToString("yyyy.MM.dd_HH.mm"))
	
	#File Dialog
	[string] $pathVar = "C:\"
	$Filter="All Files (*.*)|*.*"
	[System.Reflection.Assembly]::LoadWithPartialName("System.Windows.Forms") | Out-Null
	$objDialog = New-Object System.Windows.Forms.SaveFileDialog
	#$objDialog.InitialDirectory = 
	$objDialog.FileName = "EventStatsExport_${StartDate}-${EndDate}.csv"
	$objDialog.Filter = $Filter
	$objDialog.Title = "Export File Name"
	$objDialog.CheckFileExists = $false
	$Show = $objDialog.ShowDialog()
	if ($Show -eq "OK")
	{
		[string]$content = ""
		$filename = $objDialog.FileName
	}
	else
	{
		$FilterButton.Enabled = $true
		$dgv.Enabled = $true
		$StatusLabel.Text = ""
		$ExportButton.Enabled = $true
		$FilterButton.Enabled = $true
		$FindPreviousButton.Enabled = $true
		$CopyButton.Enabled = $true
		$FindNextButton.Enabled = $true
		$SearchButton.Enabled = $true
		$ExportStatsButton.Enabled = $true
		$ViewEventButton.Enabled = $true
		[System.Windows.Forms.Application]::DoEvents()
		return
	}
	
	if($filename -ne "" -and $filename -ne $null)
	{
		$csv = "`"Server`",`"Event ID`",`"Provider`",`"Level`",`"Count`"`r`n"
		
		$Rows = @()
		for($i=0; $i -lt $dgv.Rows.Count; $i++)
		{
			$Row = New-Object System.Object
			$Row | Add-Member -type NoteProperty -name Server -value $dgv.Rows[$i].Cells[2].Value
			$Row | Add-Member -type NoteProperty -name EventID -value $dgv.Rows[$i].Cells[3].Value
			$Row | Add-Member -type NoteProperty -name Provider -value $dgv.Rows[$i].Cells[4].Value
			$Row | Add-Member -type NoteProperty -name Level -value $dgv.Rows[$i].Cells[5].Value
			
			$Rows += $Row
		}
		
		$grouped = $Rows | group Server
		$grouped | foreach {
				
				Write-Host "Exporting Stats for:" $_.Name -foreground "green"
				$ServerName = $_.Name
				
				$EventGroup = $_.group | group EventID,Provider,Level
				$EventGroup | foreach{$EventID = $_.Name; $EventCount = $_.Count; $csv += "$ServerName,$EventID,$EventCount`r`n"}
				
		}
		
		Write-host "Writing File..."
		#Excel seems to only like UTF-8 for CSV files...
		$csv | out-file -Encoding UTF8 -FilePath $filename -Force
				
	}
	
	
	$FilterButton.Enabled = $true
	$dgv.Enabled = $true
	$StatusLabel.Text = ""
	$ExportButton.Enabled = $true
	$FilterButton.Enabled = $true
	$FindPreviousButton.Enabled = $true
	$CopyButton.Enabled = $true
	$FindNextButton.Enabled = $true
	$SearchButton.Enabled = $true
	$ExportStatsButton.Enabled = $true
	$ViewEventButton.Enabled = $true
	[System.Windows.Forms.Application]::DoEvents()
	
})
$objForm.Controls.Add($ExportStatsButton)




#File Export Browse button ============================================================
$ExportButton = New-Object System.Windows.Forms.Button
$ExportButton.Location = New-Object System.Drawing.Size(740,480)
$ExportButton.Size = New-Object System.Drawing.Size(120,20)
$ExportButton.Text = "Export Events"
$ExportButton.tabIndex = 17
$ExportButton.Anchor = [System.Windows.Forms.AnchorStyles]::Right -bor [System.Windows.Forms.AnchorStyles]::Bottom
$ExportButton.Add_Click(
{
	$filename = ""
	
	$StatusLabel.Text = "Please Wait... Exporting"
	$FilterButton.Enabled = $false
	$dgv.Enabled = $false
	$ExportButton.Enabled = $false
	$FilterButton.Enabled = $false
	$FindPreviousButton.Enabled = $false
	$CopyButton.Enabled = $false
	$FindNextButton.Enabled = $false
	$SearchButton.Enabled = $false
	$ExportStatsButton.Enabled = $false
	$ViewEventButton.Enabled = $false
	[System.Windows.Forms.Application]::DoEvents()
	
	#Get the start and end date
	$StartDate = ($StartTimePicker.Value.ToString("yyyy.MM.dd_HH.mm"))
	$EndDate = ($EndTimePicker.Value.ToString("yyyy.MM.dd_HH.mm"))
	
	
	#File Dialog
	[string] $pathVar = "C:\"
	$Filter="All Files (*.*)|*.*"
	[System.Reflection.Assembly]::LoadWithPartialName("System.Windows.Forms") | Out-Null
	$objDialog = New-Object System.Windows.Forms.SaveFileDialog
	#$objDialog.InitialDirectory = 
	$objDialog.FileName = "EventLogExport_${StartDate}-${EndDate}.csv"
	$objDialog.Filter = $Filter
	$objDialog.Title = "Export File Name"
	$objDialog.CheckFileExists = $false
	$Show = $objDialog.ShowDialog()
	if ($Show -eq "OK")
	{
		[string]$content = ""
		$filename = $objDialog.FileName
	}
	else
	{
		$FilterButton.Enabled = $true
		$dgv.Enabled = $true
		$StatusLabel.Text = ""
		$ExportButton.Enabled = $true
		$FilterButton.Enabled = $true
		$FindPreviousButton.Enabled = $true
		$CopyButton.Enabled = $true
		$FindNextButton.Enabled = $true
		$SearchButton.Enabled = $true
		$ExportStatsButton.Enabled = $true
		$ViewEventButton.Enabled = $true
		[System.Windows.Forms.Application]::DoEvents()
		return
	}
	
	if($filename -ne "" -and $filename -ne $null)
	{
		$csv = "`"Date`",`"Server`",`"Event ID`",`"Provider Name`",`"Level`",`"Message`"`r`n"
		$CurrentRowCount = 0;
		$TotalRows = $dgv.Rows.Count;
		for($i=0; $i -lt $dgv.Rows.Count; $i++)
		{
			$fileContent = ""
			for($j=1; $j -lt 7; $j++)
			{
				$cellstr = $dgv.Rows[$i].Cells[$j].Value.ToString()
				
				if($cellstr -ne $null)
				{
					$fileContent += "`"$cellstr`""
					
					if($j -le 5)
					{
						$fileContent += ","
					}
				}
			}
			###Write-Host "$fileContent"
			$csv += "$fileContent`r`n"
			$CurrentRowCount++
			if($CurrentRowCount % 100 -eq 0)
			{
				$Percentage = [math]::round(($CurrentRowCount / $TotalRows) * 100, 0)
				$StatusLabel.Text = "Please Wait... Exporting (${Percentage}%)"
				[System.Windows.Forms.Application]::DoEvents()
			}
			
		}
		#$filename = $FileLocationTextBox.text
		Write-host "Writing File..."
		#Excel seems to only like UTF-8 for CSV files...
		$csv | out-file -Encoding UTF8 -FilePath $filename -Force
	}
	
	
	$FilterButton.Enabled = $true
	$dgv.Enabled = $true
	$StatusLabel.Text = ""
	$ExportButton.Enabled = $true
	$FilterButton.Enabled = $true
	$FindPreviousButton.Enabled = $true
	$CopyButton.Enabled = $true
	$FindNextButton.Enabled = $true
	$SearchButton.Enabled = $true
	$ExportStatsButton.Enabled = $true
	$ViewEventButton.Enabled = $true
	[System.Windows.Forms.Application]::DoEvents()
	
})
$objForm.Controls.Add($ExportButton)



#Count Label ============================================================
$CountLabel = New-Object System.Windows.Forms.Label
$CountLabel.Location = New-Object System.Drawing.Size(30,90) 
$CountLabel.Size = New-Object System.Drawing.Size(200,15) 
$CountLabel.Text = ""
$CountLabel.TabStop = $false
$CountLabel.ForeColor = [System.Drawing.Color]::Blue
$CountLabel.Anchor = [System.Windows.Forms.AnchorStyles]::Left -bor [System.Windows.Forms.AnchorStyles]::Top
$objForm.Controls.Add($CountLabel)

#Data Grid View ============================================================
$dgv = New-Object Windows.Forms.DataGridView
$dgv.Size = New-Object System.Drawing.Size(840,360)
$dgv.Location = New-Object System.Drawing.Size(30,110)
$dgv.AutoGenerateColumns = $false
$dgv.RowHeadersVisible = $false
$dgv.MultiSelect = $false
$dgv.AllowUserToAddRows = $false
$dgv.SelectionMode = [Windows.Forms.DataGridViewSelectionMode]::FullRowSelect
$dgv.AutoSizeRowsMode = [Windows.Forms.DataGridViewAutoSizeRowsMode]::DisplayedCells  #DisplayedCells AllCells  - DisplayedCells is much better for a large number of rows
$dgv.AutoSizeColumnsMode = [Windows.Forms.DataGridViewAutoSizeColumnsMode]::Fill  #DisplayedCells Fill AllCells - Fill is much better for a large number of rows
$dgv.DefaultCellStyle.WrapMode = [Windows.Forms.DataGridViewTriState]::True
$dgv.Anchor = [System.Windows.Forms.AnchorStyles]::Left -bor [System.Windows.Forms.AnchorStyles]::Top -bor [System.Windows.Forms.AnchorStyles]::Right -bor [System.Windows.Forms.AnchorStyles]::Bottom


$titleColumn0 = New-Object Windows.Forms.DataGridViewImageColumn
$titleColumn0.HeaderText = ""
$titleColumn0.AutoSizeMode = [System.Windows.Forms.DataGridViewAutoSizeColumnMode]::None
$titleColumn0.SortMode = [System.Windows.Forms.DataGridViewColumnSortMode]::Automatic
$titleColumn0.ReadOnly = $true
$titleColumn0.MinimumWidth = 28
$titleColumn0.Width = 28
$dgv.Columns.Add($titleColumn0) | Out-Null


$titleColumn1 = New-Object Windows.Forms.DataGridViewTextBoxColumn
$titleColumn1.HeaderText = "Date"
$titleColumn1.AutoSizeMode = [System.Windows.Forms.DataGridViewAutoSizeColumnMode]::None
$titleColumn1.SortMode = [System.Windows.Forms.DataGridViewColumnSortMode]::Automatic
$titleColumn1.ReadOnly = $true
$titleColumn1.MinimumWidth = 80
$titleColumn1.Width = 80
$dgv.Columns.Add($titleColumn1) | Out-Null


$titleColumn2 = New-Object Windows.Forms.DataGridViewTextBoxColumn
$titleColumn2.HeaderText = "Server"
$titleColumn2.AutoSizeMode = [System.Windows.Forms.DataGridViewAutoSizeColumnMode]::None
$titleColumn2.SortMode = [System.Windows.Forms.DataGridViewColumnSortMode]::Automatic
$titleColumn2.ReadOnly = $true
$titleColumn2.MinimumWidth = 100
$titleColumn2.Width = 100
$dgv.Columns.Add($titleColumn2) | Out-Null

$titleColumn3 = New-Object Windows.Forms.DataGridViewTextBoxColumn
$titleColumn3.HeaderText = "Event ID"
$titleColumn3.AutoSizeMode = [System.Windows.Forms.DataGridViewAutoSizeColumnMode]::None
$titleColumn3.SortMode = [System.Windows.Forms.DataGridViewColumnSortMode]::Automatic
$titleColumn3.ReadOnly = $true
$titleColumn3.MinimumWidth = 60
$titleColumn3.Width = 60
$dgv.Columns.Add($titleColumn3) | Out-Null

$titleColumn4 = New-Object Windows.Forms.DataGridViewTextBoxColumn
$titleColumn4.HeaderText = "Provider"
$titleColumn4.AutoSizeMode = [System.Windows.Forms.DataGridViewAutoSizeColumnMode]::None
$titleColumn4.SortMode = [System.Windows.Forms.DataGridViewColumnSortMode]::Automatic
$titleColumn4.ReadOnly = $true
$titleColumn4.MinimumWidth = 80
$titleColumn4.Width = 80
$dgv.Columns.Add($titleColumn4) | Out-Null

$titleColumn5 = New-Object Windows.Forms.DataGridViewTextBoxColumn
$titleColumn5.HeaderText = "Level"
$titleColumn5.AutoSizeMode = [System.Windows.Forms.DataGridViewAutoSizeColumnMode]::None
$titleColumn5.SortMode = [System.Windows.Forms.DataGridViewColumnSortMode]::Automatic
$titleColumn5.ReadOnly = $true
$titleColumn5.MinimumWidth = 50
$titleColumn5.Width = 50
$dgv.Columns.Add($titleColumn5) | Out-Null


$titleColumn6 = New-Object Windows.Forms.DataGridViewTextBoxColumn
$titleColumn6.HeaderText = "Message"
$titleColumn6.AutoSizeMode = [System.Windows.Forms.DataGridViewAutoSizeColumnMode]::Fill
$titleColumn6.SortMode = [System.Windows.Forms.DataGridViewColumnSortMode]::Automatic
$titleColumn6.ReadOnly = $true
$dgv.Columns.Add($titleColumn6) | Out-Null
$objForm.Controls.Add($dgv)


# $StatusLabel ============================================================
$StatusLabel = New-Object System.Windows.Forms.Label
$StatusLabel.Location = New-Object System.Drawing.Size(20,510) 
$StatusLabel.Size = New-Object System.Drawing.Size(700,15) 
$StatusLabel.Text = ""
$StatusLabel.Anchor = [System.Windows.Forms.AnchorStyles]::Left -bor [System.Windows.Forms.AnchorStyles]::Bottom
$StatusLabel.ForeColor = [System.Drawing.Color]::Red
$StatusLabel.TabStop = $false
$objForm.Controls.Add($StatusLabel)




function MessageView([string]$Message, [string]$WindowTitle, [string]$DefaultText)
{
    Add-Type -AssemblyName System.Drawing
    Add-Type -AssemblyName System.Windows.Forms
    
	#Message Text Start Text box ============================================================
	$MessageTextBox = new-object System.Windows.Forms.textbox
	$MessageTextBox.location = new-object system.drawing.size(5,5)
	$MessageTextBox.size = new-object system.drawing.size(670,445)
	$MessageTextBox.Multiline = $True	
	$MessageTextBox.Wordwrap = $True
	$MessageTextBox.ScrollBars = [System.Windows.Forms.ScrollBars]::Vertical
	$MessageTextBox.Anchor = [System.Windows.Forms.AnchorStyles]::Left -bor [System.Windows.Forms.AnchorStyles]::Right -bor [System.Windows.Forms.AnchorStyles]::Bottom -bor [System.Windows.Forms.AnchorStyles]::Top
	$MessageTextBox.text = $Message  
	$MessageTextBox.tabIndex = 0
	$MessageTextBox.Select(0,0)

    # Create the form.
    $form = New-Object System.Windows.Forms.Form 
    $form.Text = $WindowTitle
    $form.Size = New-Object System.Drawing.Size(700,500)
    $form.FormBorderStyle = 'Sizable'
    $form.StartPosition = "CenterScreen"
    $form.Topmost = $True
	$form.MinimumSize = New-Object System.Drawing.Size(200,200) 
	[byte[]]$WindowIcon = @(66, 77, 56, 3, 0, 0, 0, 0, 0, 0, 54, 0, 0, 0, 40, 0, 0, 0, 16, 0, 0, 0, 16, 0, 0, 0, 1, 0, 24, 0, 0, 0, 0, 0, 2, 3, 0, 0, 18, 11, 0, 0, 18, 11, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114,0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0,198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 205, 132, 32, 234, 202, 160,255, 255, 255, 244, 229, 208, 205, 132, 32, 202, 123, 16, 248, 238, 224, 198, 114, 0, 205, 132, 32, 234, 202, 160, 255,255, 255, 255, 255, 255, 244, 229, 208, 219, 167, 96, 198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 248, 238, 224, 198, 114, 0, 198, 114, 0, 223, 176, 112, 255, 255, 255, 219, 167, 96, 198, 114, 0, 198, 114, 0, 255, 255, 255, 255, 255, 255, 227, 185, 128, 198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 241, 220, 192, 198, 114, 0, 198,114, 0, 248, 238, 224, 255, 255, 255, 244, 229, 208, 198, 114, 0, 198, 114, 0, 255, 255, 255, 255, 255, 255, 227, 185, 128, 198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 241, 220, 192, 198, 114, 0, 216, 158, 80, 255, 255, 255, 255, 255, 255, 252, 247, 240, 209, 141, 48, 198, 114, 0, 255, 255, 255, 255, 255, 255, 227, 185, 128, 198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 241, 220, 192, 198, 114, 0, 241, 220, 192, 255, 255, 255, 252, 247, 240, 212, 149, 64, 234, 202, 160, 198, 114, 0, 255, 255, 255, 255, 255, 255, 227, 185, 128, 198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 241, 220, 192, 205, 132, 32, 255, 255, 255, 255, 255, 255, 227, 185, 128, 198, 114, 0, 248, 238, 224, 202, 123, 16, 255, 255, 255, 255, 255, 255, 227, 185, 128, 198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 241, 220, 192, 234, 202, 160, 255, 255, 255, 255, 255, 255, 205, 132, 32, 198, 114, 0, 223, 176, 112, 223, 176, 112, 255, 255, 255, 255, 255, 255, 227, 185, 128, 198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 244, 229, 208, 252, 247, 240, 255, 255, 255, 237, 211, 176, 198, 114, 0, 198, 114, 0, 202, 123, 16, 248, 238, 224, 255, 255, 255, 255, 255, 255, 227, 185, 128, 198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 212, 149, 64, 255, 255, 255, 255, 255, 255, 255, 255, 255, 212, 149, 64, 198, 114, 0, 198, 114, 0, 198, 114, 0, 234, 202, 160, 255, 255,255, 255, 255, 255, 241, 220, 192, 205, 132, 32, 198, 114, 0, 198, 114, 0, 205, 132, 32, 227, 185, 128, 227, 185, 128, 227, 185, 128, 227, 185, 128, 198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 205, 132, 32, 227, 185, 128, 227, 185,128, 227, 185, 128, 219, 167, 96, 198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 198, 114, 0, 0, 0)
	$ico = New-Object IO.MemoryStream($WindowIcon, 0, $WindowIcon.Length)
	$form.Icon = [System.Drawing.Icon]::FromHandle((new-object System.Drawing.Bitmap -argument $ico).GetHIcon())
     
    # Add all of the controls to the form.
	$form.controls.add($MessageTextBox)

    # Initialize and show the form.
    $form.Add_Shown({$form.Activate()})
    $form.ShowDialog() > $null   # Trash the text of the button that was clicked.

}

			
function Get-ErrorLog
{
	$Hours = $HoursNumberBox.Value
	[DateTime]$StartHour = $StartTimePicker.Value
	[DateTime]$EndHour = $EndTimePicker.Value
	
	$DateCheck = [System.DateTime]::Compare($StartHour, $EndHour)
	
	if($DateCheck -lt 0)
	{
		$dgv.Rows.Clear()
		write-host "Started....." -foreground "green"

		[System.Globalization.CultureInfo]$culture = "en-US"
		$OldCulture = [System.Threading.Thread]::CurrentThread.CurrentCulture
		[System.Threading.Thread]::CurrentThread.CurrentCulture = $OldCulture
		[System.Threading.Thread]::CurrentThread.CurrentCulture = $culture

		invoke-expression [System.Threading.Thread]::CurrentThread.CurrentCulture
			
		
		if($ServerTextBox.SelectedItem.ToString() -eq "ALL SERVERS")
		{
			$computers = @()
			Get-CsPool | where-object {$_.Services -like "Registrar*" -or $_.Services -like "EdgeServer*" -or $_.Services -like "PersistentChatServer*"} | select-object Computers | ForEach-Object {$computers +=  $_.Computers}
		}
		elseif($ServerTextBox.SelectedItem.ToString() -eq "ALL FRONTENDS")
		{
			$computers = @()
			Get-CsPool | where-object {$_.Services -like "Registrar*"} | select-object Computers | ForEach-Object {$computers +=  $_.Computers}
		}
		else
		{
			$computers = @()
			[string]$selectedItem = $ServerTextBox.SelectedItem.ToString()
			
			Write-Host "SELECTED ITEM: $selectedItem"
			if($selectedItem -match "Pool:")
			{
				Write-Host "MATCHED pool"
				$selectedItem = $selectedItem.Replace("Pool:","")
				$thePool = Get-CsPool -Identity $selectedItem
				
				foreach($server in $thePool.Computers)
				{
					$computers += $server
				}
			}
			else
			{
				$computers = @($selectedItem)
			}
		}

		
		foreach($computerName in $computers)
		{
			if($CancelScan)
			{
				break
			}
			
			$StatusLabel.Text = "Please Wait - Getting events from ${computerName}..."
			[System.Windows.Forms.Application]::DoEvents()
			
			Write-Host "Connecting to ${computerName}..." -foreground "Yellow"
			
			$events = @()
			[int]$NoOfErrors = 50000
			
			$theError = ""
			
			if($InformationCheckBox.Checked -and $CancelScan -eq $false)
			{
				$StatusLabel.Text = "Please Wait - Getting events from ${computerName}... (Information)"
				[System.Windows.Forms.Application]::DoEvents()
				Try {
					Write-Host "RUNNING: Get-Winevent -FilterHashtable @{LogName=`"$LogName`"; Level=4; StartTime=$StartHour; EndTime=$EndHour} -MaxEvents $NoOfErrors -computername $computerName" -foreground "green"
					$events += Get-Winevent -FilterHashtable @{LogName="$LogName"; Level=4; StartTime=$StartHour; EndTime=$EndHour} -MaxEvents $NoOfErrors -computername $computerName -ErrorAction SilentlyContinue
				} 
				Catch [Exception] {
					$theError = $_.Exception.Message
					Write-Host "INFO: " $_.Exception.Message -foreground "Yellow"
					
					if($theError -eq "The RPC server is unavailable")
					{
						Write-Host "ERROR: Ensure that the server $computerName has the `"Remote Event Log Management (RPC)`" rule enabled in it's Windows firewall." -Foreground "Red"
					}
				}
			}
			if($WarningCheckBox.Checked -and $CancelScan -eq $false)
			{
				$StatusLabel.Text = "Please Wait - Getting events from ${computerName}... (Warning)"
				[System.Windows.Forms.Application]::DoEvents()
				Try {
					if($theError -ne "The RPC server is unavailable")
					{
						Write-Host "RUNNING: Get-Winevent -FilterHashtable @{LogName=`"$LogName`"; Level=3; StartTime=$StartHour; EndTime=$EndHour} -MaxEvents $NoOfErrors -computername $computerName" -foreground "green"
						$events += Get-Winevent -FilterHashtable @{LogName="$LogName"; Level=3; StartTime=$StartHour; EndTime=$EndHour} -MaxEvents $NoOfErrors -computername $computerName -ErrorAction SilentlyContinue 
					}
				} 
				Catch [Exception] {
					$theError = $_.Exception.Message
					Write-Host "INFO: " $_.Exception.Message -foreground "Yellow"
					
					if($theError -eq "The RPC server is unavailable")
					{
						Write-Host "ERROR: Ensure that the server $computerName has the `"Remote Event Log Management (RPC)`" rule enabled in it's Windows firewall." -Foreground "Red"
					}
				}
			}
			if($ErrorCheckBox.Checked -and $CancelScan -eq $false)
			{
				$StatusLabel.Text = "Please Wait - Getting events from ${computerName}... (Error)"
				[System.Windows.Forms.Application]::DoEvents()
				Try {
					if($theError -ne "The RPC server is unavailable")
					{
						Write-Host "RUNNING: Get-Winevent -FilterHashtable @{LogName=`"$LogName`"; Level=2; StartTime=$StartHour; EndTime=$EndHour} -MaxEvents $NoOfErrors -computername $computerName" -foreground "green"
						$events += Get-Winevent -FilterHashtable @{LogName="$LogName"; Level=2; StartTime=$StartHour; EndTime=$EndHour} -MaxEvents $NoOfErrors -computername $computerName -ErrorAction SilentlyContinue 
					}
				}
				Catch [Exception] {
					$theError = $_.Exception.Message
					Write-Host "INFO: " $_.Exception.Message -foreground "Yellow"
					
					if($theError -eq "The RPC server is unavailable")
					{
						Write-Host "ERROR: Ensure that the server $computerName has the `"Remote Event Log Management (RPC)`" rule enabled in it's Windows firewall." -Foreground "Red"
					}
				}
			}
			if($CriticalCheckBox.Checked -and $CancelScan -eq $false)
			{
				$StatusLabel.Text = "Please Wait - Getting events from ${computerName}... (Critical)"
				[System.Windows.Forms.Application]::DoEvents()
				Try {	
					if($theError -ne "The RPC server is unavailable")
					{
						Write-Host "RUNNING: Get-Winevent -FilterHashtable @{LogName=`"$LogName`"; Level=1; StartTime=$StartHour; EndTime=$EndHour} -MaxEvents $NoOfErrors -computername $computerName" -foreground "green"
						$events += Get-Winevent -FilterHashtable @{LogName="$LogName"; Level=1; StartTime=$StartHour; EndTime=$EndHour} -MaxEvents $NoOfErrors -computername $computerName -ErrorAction SilentlyContinue 
					}
				} 
				Catch [Exception] {
					$theError = $_.Exception.Message
					Write-Host "INFO: " $_.Exception.Message -foreground "Yellow"
					
					if($theError -eq "The RPC server is unavailable")
					{
						Write-Host "ERROR: Ensure that the server $computerName has the `"Remote Event Log Management (RPC)`" rule enabled in it's Windows firewall." -Foreground "Red"
					}
				}
			}
			
			if($events -ne $null)
			{
				#Write-Host "Got events from ${computerName}." -foreground "Green"
				
				$EventCount = 0
				$TotalEventCount = $events.Count
				foreach($event in $events)
				{
					if($CancelScan)
					{
						break
					}
					
					[string]$TimeCreated = $event.TimeCreated.ToString("yyyy/MM/dd HH:mm:ss")  #Use a sortable format!
					[string]$EventID = $event.ID
					[string]$ProviderName = $event.ProviderName
					[string]$Level = $event.LevelDisplayName
					[string]$Message = $event.FormatDescription()
					
					[string]$FilterExcludeRegex = $EventIDExcludeTextBox.Text
					[string]$FilterIncludeRegex = $EventIDTextBox.Text
					
					if($FilterExcludeRegex -ne "" -and $FilterIncludeRegex -ne "")
					{
						if(($EventID notmatch $FilterExcludeRegex) -or ($EventID -match $FilterExcludeRegex))
						{
							#Write-Host "Server: $computerName"
							#Write-Host "Event ID: $EventID"
							#Write-Host "ProviderName: $ProviderName"
							#Write-Host "Level: $Level"
							#Write-Host "Message: $Message"
							#Write-Host ""
							
							if($Level -eq "ERROR")
							{
								$dgv.Rows.Add( @($ErrorImage,"$TimeCreated","$computerName","$EventID","$ProviderName","$Level","$Message") )
							}
							elseif($Level -eq "CRITICAL")
							{
								$dgv.Rows.Add( @($CriticalImage,"$TimeCreated","$computerName","$EventID","$ProviderName","$Level","$Message") )
							}
							elseif($Level -eq "WARNING")
							{
								$dgv.Rows.Add( @($WarningImage,"$TimeCreated","$computerName","$EventID","$ProviderName","$Level","$Message") )
							}
							elseif($Level -eq "INFORMATION")
							{
								$dgv.Rows.Add( @($InfoImage,"$TimeCreated","$computerName","$EventID","$ProviderName","Info","$Message") )
							}
						}
					}
					elseif($FilterExcludeRegex -ne "" -and $FilterIncludeRegex -eq "")
					{
						if($EventID notmatch $FilterExcludeRegex)
						{
							#Write-Host "Server: $computerName"
							#Write-Host "Event ID: $EventID"
							#Write-Host "ProviderName: $ProviderName"
							#Write-Host "Level: $Level"
							#Write-Host "Message: $Message"
							#Write-Host ""
							
							if($Level -eq "ERROR")
							{
								$dgv.Rows.Add( @($ErrorImage,"$TimeCreated","$computerName","$EventID","$ProviderName","$Level","$Message") )
							}
							elseif($Level -eq "CRITICAL")
							{
								$dgv.Rows.Add( @($CriticalImage,"$TimeCreated","$computerName","$EventID","$ProviderName","$Level","$Message") )
							}
							elseif($Level -eq "WARNING")
							{
								$dgv.Rows.Add( @($WarningImage,"$TimeCreated","$computerName","$EventID","$ProviderName","$Level","$Message") )
							}
							elseif($Level -eq "INFORMATION")
							{
								$dgv.Rows.Add( @($InfoImage,"$TimeCreated","$computerName","$EventID","$ProviderName","Info","$Message") )
							}
						}
					}
					elseif($FilterExcludeRegex -eq "" -and $FilterIncludeRegex -ne "")
					{
						if($EventID match $FilterIncludeRegex)
						{
							#Write-Host "Server: $computerName"
							#Write-Host "Event ID: $EventID"
							#Write-Host "ProviderName: $ProviderName"
							#Write-Host "Level: $Level"
							#Write-Host "Message: $Message"
							#Write-Host ""

							if($Level -eq "ERROR")
							{
								$dgv.Rows.Add( @($ErrorImage,"$TimeCreated","$computerName","$EventID","$ProviderName","$Level","$Message") )
							}
							elseif($Level -eq "CRITICAL")
							{
								$dgv.Rows.Add( @($CriticalImage,"$TimeCreated","$computerName","$EventID","$ProviderName","$Level","$Message") )
							}
							elseif($Level -eq "WARNING")
							{
								$dgv.Rows.Add( @($WarningImage,"$TimeCreated","$computerName","$EventID","$ProviderName","$Level","$Message") )
							}
							elseif($Level -eq "INFORMATION")
							{
								$dgv.Rows.Add( @($InfoImage,"$TimeCreated","$computerName","$EventID","$ProviderName","Info","$Message") )
							}
						}
					}
					elseif($FilterExcludeRegex -eq "" -and $FilterIncludeRegex -eq "")
					{
						#Write-Host "Server: $computerName"
						#Write-Host "Event ID: $EventID"
						#Write-Host "ProviderName: $ProviderName"
						#Write-Host "Level: $Level"
						#Write-Host "Message: $Message"
						#Write-Host ""
						
						if($Level -eq "ERROR")
						{
							$dgv.Rows.Add( @($ErrorImage,"$TimeCreated","$computerName","$EventID","$ProviderName","$Level","$Message") )
						}
						elseif($Level -eq "CRITICAL")
						{
							$dgv.Rows.Add( @($CriticalImage,"$TimeCreated","$computerName","$EventID","$ProviderName","$Level","$Message") )
						}
						elseif($Level -eq "WARNING")
						{
							$dgv.Rows.Add( @($WarningImage,"$TimeCreated","$computerName","$EventID","$ProviderName","$Level","$Message") )
						}
						elseif($Level -eq "INFORMATION")
						{
							$dgv.Rows.Add( @($InfoImage,"$TimeCreated","$computerName","$EventID","$ProviderName","Info","$Message") )
						}
						
					}
					
					$EventCount++
					if($EventCount % 100 -eq 0)
					{
						$Percentage = [math]::round(($EventCount / $TotalEventCount) * 100, 0)
						$StatusLabel.Text = "Please Wait - Getting events from ${computerName}... (Processing $TotalEventCount Events ${Percentage}%)"
						[System.Windows.Forms.Application]::DoEvents()
					}
				}
			}
			else
			{
				Write-Host "Recieved no events from ${computerName}." -foreground "Yellow"
			}
			$NumberOfRows = $dgv.Rows.Count
			$CountLabel.Text = "Number of Events: $NumberOfRows"
		}
		
		#This section was used to colour the Level text. However, it added too much to the processing time for little gain. So it was removed.
		<#
		$StatusLabel.Text = "Please Wait - Processing Rows..."
		[System.Windows.Forms.Application]::DoEvents()
					
		#$Font = New-Object System.Drawing.Font("Arial",9,[System.Drawing.FontStyle]::Bold)
		# Font styles are: Regular, Bold, Italic, Underline, Strikeout
		foreach($row in $dgv.Rows)
		{
			if($CancelScan)
			{
				break
			}
			
			[string] $RowType = $row.Cells[5].Value.ToString()
			#Write-Host "Setting Colour: $row   $RowType"
			
			#It turns out that font bolding is an expensive operation. So this have been removed.
			if($RowType -eq "ERROR")
			{
				$row.Cells[5].Style.ForeColor = [System.Drawing.Color]::Tomato
				#$row.Cells[4].Style.Font = $Font
			}
			elseif($RowType -eq "CRITICAL")
			{
				$row.Cells[5].Style.ForeColor = [System.Drawing.Color]::Maroon
				#$row.Cells[4].Style.Font = $Font
			}
			elseif($RowType -eq "WARNING")
			{
				$row.Cells[5].Style.ForeColor = [System.Drawing.Color]::Orange
				#$row.Cells[4].Style.Font = $Font
			}
			
		}
		#>
		
		$StatusLabel.Text = "Please Wait - Sorting Rows..."
		[System.Windows.Forms.Application]::DoEvents()
		
		#SORT THE ROWS
		$dgv.Sort($titleColumn1, [System.ComponentModel.ListSortDirection]::Descending)
		
		[System.Threading.Thread]::CurrentThread.CurrentCulture = $OldCulture
		invoke-expression [System.Threading.Thread]::CurrentThread.CurrentCulture
		
		
		if($CancelScan)
		{
			$Script:CancelScan = $false
			$CancelDiscoverButton.Visible = $false
			$CancelDiscoverButton.Enabled = $true
			$StatusLabel.Text = ""
			Write-Host "CANCELLED!" -Foreground "Red"
		}
		else
		{
			Write-Host "FINISHED!" -Foreground "Green"
		}
		[System.Windows.Forms.Application]::DoEvents()
			
		
	}
	else
	{
		[System.Windows.Forms.MessageBox]::Show("The end date must be later than the start date!") 
	}
}


# Activate the form ============================================================
$objForm.Add_Shown({$objForm.Activate()})
[void] $objForm.ShowDialog()	


# SIG # Begin signature block
# MIIcZgYJKoZIhvcNAQcCoIIcVzCCHFMCAQExCzAJBgUrDgMCGgUAMGkGCisGAQQB
# gjcCAQSgWzBZMDQGCisGAQQBgjcCAR4wJgIDAQAABBAfzDtgWUsITrck0sYpfvNR
# AgEAAgEAAgEAAgEAAgEAMCEwCQYFKw4DAhoFAAQU4gVVCxdJe6TDl2wlfNPlfx/+
# hbWggheVMIIFHjCCBAagAwIBAgIQBxBUyrsGP0WD0llLNI3mkDANBgkqhkiG9w0B
# AQsFADByMQswCQYDVQQGEwJVUzEVMBMGA1UEChMMRGlnaUNlcnQgSW5jMRkwFwYD
# VQQLExB3d3cuZGlnaWNlcnQuY29tMTEwLwYDVQQDEyhEaWdpQ2VydCBTSEEyIEFz
# c3VyZWQgSUQgQ29kZSBTaWduaW5nIENBMB4XDTE2MDUyNTAwMDAwMFoXDTE3MDYw
# MTEyMDAwMFowWzELMAkGA1UEBhMCQVUxDDAKBgNVBAgTA1ZJQzEQMA4GA1UEBxMH
# TWl0Y2hhbTEVMBMGA1UEChMMSmFtZXMgQ3Vzc2VuMRUwEwYDVQQDEwxKYW1lcyBD
# dXNzZW4wggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQC6GZ520eI8sd+b
# 3JJ37+3ctFk2x40odAMoNmTpzxkAoiRJpjyAyf8vwra5AmW0ccK4GvKiDsZy9kmA
# knpTVTuQ+3lTqVL1HrSvSVGihaBjB3EMgbG4LmNYLsBA6ruM33Ux4br9x67k5XdQ
# HlrImq3h5LqaWOfQfeoR/ZG65y0Z7oImeZfE8lLQ4EsvOfkj4HuOZ4mJVxB4SVKk
# CrtYeVanc9rK6iix2l5H7egVgzK4M/t1upyRm25CvdD/BEL6x0ctaA1pctKG79re
# 5ck/r2No1dNECAI7odcHqzqyCQn912rzGcgsaIYtndNPOkLi9vFUd41RP2hvyZW/
# HaO8ANMhAgMBAAGjggHFMIIBwTAfBgNVHSMEGDAWgBRaxLl7KgqjpepxA8Bg+S32
# ZXUOWDAdBgNVHQ4EFgQU0HDHNV7TPv7EjK+/KsmbgQXrjKcwDgYDVR0PAQH/BAQD
# AgeAMBMGA1UdJQQMMAoGCCsGAQUFBwMDMHcGA1UdHwRwMG4wNaAzoDGGL2h0dHA6
# Ly9jcmwzLmRpZ2ljZXJ0LmNvbS9zaGEyLWFzc3VyZWQtY3MtZzEuY3JsMDWgM6Ax
# hi9odHRwOi8vY3JsNC5kaWdpY2VydC5jb20vc2hhMi1hc3N1cmVkLWNzLWcxLmNy
# bDBMBgNVHSAERTBDMDcGCWCGSAGG/WwDATAqMCgGCCsGAQUFBwIBFhxodHRwczov
# L3d3dy5kaWdpY2VydC5jb20vQ1BTMAgGBmeBDAEEATCBhAYIKwYBBQUHAQEEeDB2
# MCQGCCsGAQUFBzABhhhodHRwOi8vb2NzcC5kaWdpY2VydC5jb20wTgYIKwYBBQUH
# MAKGQmh0dHA6Ly9jYWNlcnRzLmRpZ2ljZXJ0LmNvbS9EaWdpQ2VydFNIQTJBc3N1
# cmVkSURDb2RlU2lnbmluZ0NBLmNydDAMBgNVHRMBAf8EAjAAMA0GCSqGSIb3DQEB
# CwUAA4IBAQDRxxHkWrGmGM9DZO8P+jJd6B+sDmJI1qkyLkUpZozzvPPfNdOWfmOd
# HgmI6aLO4AtmgDwYXTNVzy/gKQb9loGc3qVPEwhu6NewdQEhS+PnaBFsG3FJXvXN
# MlE5yWiHKSFrYrVZecOaRLeQ6MmsRcRfaL9lucxJW+MFU5cEer8g3+ixcDwaSIb6
# S+U/fBNyJTQs2rokiOkI5cYAseLeImG/C5GJU8tf9rA0GF19pVwbAS+wMy1RT5t0
# uikvGrGube2bWVTC4EweGCWb/yJfRpZN0q8fuORopoaJvPWyA4TgUlOCCgK36nDK
# 6jnBZ12w+JOuHhfcvmigbNLHaFmzqhkaMIIFMDCCBBigAwIBAgIQBAkYG1/Vu2Z1
# U0O1b5VQCDANBgkqhkiG9w0BAQsFADBlMQswCQYDVQQGEwJVUzEVMBMGA1UEChMM
# RGlnaUNlcnQgSW5jMRkwFwYDVQQLExB3d3cuZGlnaWNlcnQuY29tMSQwIgYDVQQD
# ExtEaWdpQ2VydCBBc3N1cmVkIElEIFJvb3QgQ0EwHhcNMTMxMDIyMTIwMDAwWhcN
# MjgxMDIyMTIwMDAwWjByMQswCQYDVQQGEwJVUzEVMBMGA1UEChMMRGlnaUNlcnQg
# SW5jMRkwFwYDVQQLExB3d3cuZGlnaWNlcnQuY29tMTEwLwYDVQQDEyhEaWdpQ2Vy
# dCBTSEEyIEFzc3VyZWQgSUQgQ29kZSBTaWduaW5nIENBMIIBIjANBgkqhkiG9w0B
# AQEFAAOCAQ8AMIIBCgKCAQEA+NOzHH8OEa9ndwfTCzFJGc/Q+0WZsTrbRPV/5aid
# 2zLXcep2nQUut4/6kkPApfmJ1DcZ17aq8JyGpdglrA55KDp+6dFn08b7KSfH03sj
# lOSRI5aQd4L5oYQjZhJUM1B0sSgmuyRpwsJS8hRniolF1C2ho+mILCCVrhxKhwjf
# DPXiTWAYvqrEsq5wMWYzcT6scKKrzn/pfMuSoeU7MRzP6vIK5Fe7SrXpdOYr/mzL
# fnQ5Ng2Q7+S1TqSp6moKq4TzrGdOtcT3jNEgJSPrCGQ+UpbB8g8S9MWOD8Gi6CxR
# 93O8vYWxYoNzQYIH5DiLanMg0A9kczyen6Yzqf0Z3yWT0QIDAQABo4IBzTCCAckw
# EgYDVR0TAQH/BAgwBgEB/wIBADAOBgNVHQ8BAf8EBAMCAYYwEwYDVR0lBAwwCgYI
# KwYBBQUHAwMweQYIKwYBBQUHAQEEbTBrMCQGCCsGAQUFBzABhhhodHRwOi8vb2Nz
# cC5kaWdpY2VydC5jb20wQwYIKwYBBQUHMAKGN2h0dHA6Ly9jYWNlcnRzLmRpZ2lj
# ZXJ0LmNvbS9EaWdpQ2VydEFzc3VyZWRJRFJvb3RDQS5jcnQwgYEGA1UdHwR6MHgw
# OqA4oDaGNGh0dHA6Ly9jcmw0LmRpZ2ljZXJ0LmNvbS9EaWdpQ2VydEFzc3VyZWRJ
# RFJvb3RDQS5jcmwwOqA4oDaGNGh0dHA6Ly9jcmwzLmRpZ2ljZXJ0LmNvbS9EaWdp
# Q2VydEFzc3VyZWRJRFJvb3RDQS5jcmwwTwYDVR0gBEgwRjA4BgpghkgBhv1sAAIE
# MCowKAYIKwYBBQUHAgEWHGh0dHBzOi8vd3d3LmRpZ2ljZXJ0LmNvbS9DUFMwCgYI
# YIZIAYb9bAMwHQYDVR0OBBYEFFrEuXsqCqOl6nEDwGD5LfZldQ5YMB8GA1UdIwQY
# MBaAFEXroq/0ksuCMS1Ri6enIZ3zbcgPMA0GCSqGSIb3DQEBCwUAA4IBAQA+7A1a
# JLPzItEVyCx8JSl2qB1dHC06GsTvMGHXfgtg/cM9D8Svi/3vKt8gVTew4fbRknUP
# UbRupY5a4l4kgU4QpO4/cY5jDhNLrddfRHnzNhQGivecRk5c/5CxGwcOkRX7uq+1
# UcKNJK4kxscnKqEpKBo6cSgCPC6Ro8AlEeKcFEehemhor5unXCBc2XGxDI+7qPjF
# Emifz0DLQESlE/DmZAwlCEIysjaKJAL+L3J+HNdJRZboWR3p+nRka7LrZkPas7CM
# 1ekN3fYBIM6ZMWM9CBoYs4GbT8aTEAb8B4H6i9r5gkn3Ym6hU/oSlBiFLpKR6mhs
# RDKyZqHnGKSaZFHvMIIGajCCBVKgAwIBAgIQAwGaAjr/WLFr1tXq5hfwZjANBgkq
# hkiG9w0BAQUFADBiMQswCQYDVQQGEwJVUzEVMBMGA1UEChMMRGlnaUNlcnQgSW5j
# MRkwFwYDVQQLExB3d3cuZGlnaWNlcnQuY29tMSEwHwYDVQQDExhEaWdpQ2VydCBB
# c3N1cmVkIElEIENBLTEwHhcNMTQxMDIyMDAwMDAwWhcNMjQxMDIyMDAwMDAwWjBH
# MQswCQYDVQQGEwJVUzERMA8GA1UEChMIRGlnaUNlcnQxJTAjBgNVBAMTHERpZ2lD
# ZXJ0IFRpbWVzdGFtcCBSZXNwb25kZXIwggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAw
# ggEKAoIBAQCjZF38fLPggjXg4PbGKuZJdTvMbuBTqZ8fZFnmfGt/a4ydVfiS457V
# WmNbAklQ2YPOb2bu3cuF6V+l+dSHdIhEOxnJ5fWRn8YUOawk6qhLLJGJzF4o9GS2
# ULf1ErNzlgpno75hn67z/RJ4dQ6mWxT9RSOOhkRVfRiGBYxVh3lIRvfKDo2n3k5f
# 4qi2LVkCYYhhchhoubh87ubnNC8xd4EwH7s2AY3vJ+P3mvBMMWSN4+v6GYeofs/s
# jAw2W3rBerh4x8kGLkYQyI3oBGDbvHN0+k7Y/qpA8bLOcEaD6dpAoVk62RUJV5lW
# MJPzyWHM0AjMa+xiQpGsAsDvpPCJEY93AgMBAAGjggM1MIIDMTAOBgNVHQ8BAf8E
# BAMCB4AwDAYDVR0TAQH/BAIwADAWBgNVHSUBAf8EDDAKBggrBgEFBQcDCDCCAb8G
# A1UdIASCAbYwggGyMIIBoQYJYIZIAYb9bAcBMIIBkjAoBggrBgEFBQcCARYcaHR0
# cHM6Ly93d3cuZGlnaWNlcnQuY29tL0NQUzCCAWQGCCsGAQUFBwICMIIBVh6CAVIA
# QQBuAHkAIAB1AHMAZQAgAG8AZgAgAHQAaABpAHMAIABDAGUAcgB0AGkAZgBpAGMA
# YQB0AGUAIABjAG8AbgBzAHQAaQB0AHUAdABlAHMAIABhAGMAYwBlAHAAdABhAG4A
# YwBlACAAbwBmACAAdABoAGUAIABEAGkAZwBpAEMAZQByAHQAIABDAFAALwBDAFAA
# UwAgAGEAbgBkACAAdABoAGUAIABSAGUAbAB5AGkAbgBnACAAUABhAHIAdAB5ACAA
# QQBnAHIAZQBlAG0AZQBuAHQAIAB3AGgAaQBjAGgAIABsAGkAbQBpAHQAIABsAGkA
# YQBiAGkAbABpAHQAeQAgAGEAbgBkACAAYQByAGUAIABpAG4AYwBvAHIAcABvAHIA
# YQB0AGUAZAAgAGgAZQByAGUAaQBuACAAYgB5ACAAcgBlAGYAZQByAGUAbgBjAGUA
# LjALBglghkgBhv1sAxUwHwYDVR0jBBgwFoAUFQASKxOYspkH7R7for5XDStnAs0w
# HQYDVR0OBBYEFGFaTSS2STKdSip5GoNL9B6Jwcp9MH0GA1UdHwR2MHQwOKA2oDSG
# Mmh0dHA6Ly9jcmwzLmRpZ2ljZXJ0LmNvbS9EaWdpQ2VydEFzc3VyZWRJRENBLTEu
# Y3JsMDigNqA0hjJodHRwOi8vY3JsNC5kaWdpY2VydC5jb20vRGlnaUNlcnRBc3N1
# cmVkSURDQS0xLmNybDB3BggrBgEFBQcBAQRrMGkwJAYIKwYBBQUHMAGGGGh0dHA6
# Ly9vY3NwLmRpZ2ljZXJ0LmNvbTBBBggrBgEFBQcwAoY1aHR0cDovL2NhY2VydHMu
# ZGlnaWNlcnQuY29tL0RpZ2lDZXJ0QXNzdXJlZElEQ0EtMS5jcnQwDQYJKoZIhvcN
# AQEFBQADggEBAJ0lfhszTbImgVybhs4jIA+Ah+WI//+x1GosMe06FxlxF82pG7xa
# FjkAneNshORaQPveBgGMN/qbsZ0kfv4gpFetW7easGAm6mlXIV00Lx9xsIOUGQVr
# NZAQoHuXx/Y/5+IRQaa9YtnwJz04HShvOlIJ8OxwYtNiS7Dgc6aSwNOOMdgv420X
# Ewbu5AO2FKvzj0OncZ0h3RTKFV2SQdr5D4HRmXQNJsQOfxu19aDxxncGKBXp2JPl
# VRbwuwqrHNtcSCdmyKOLChzlldquxC5ZoGHd2vNtomHpigtt7BIYvfdVVEADkitr
# wlHCCkivsNRu4PQUCjob4489yq9qjXvc2EQwggbNMIIFtaADAgECAhAG/fkDlgOt
# 6gAK6z8nu7obMA0GCSqGSIb3DQEBBQUAMGUxCzAJBgNVBAYTAlVTMRUwEwYDVQQK
# EwxEaWdpQ2VydCBJbmMxGTAXBgNVBAsTEHd3dy5kaWdpY2VydC5jb20xJDAiBgNV
# BAMTG0RpZ2lDZXJ0IEFzc3VyZWQgSUQgUm9vdCBDQTAeFw0wNjExMTAwMDAwMDBa
# Fw0yMTExMTAwMDAwMDBaMGIxCzAJBgNVBAYTAlVTMRUwEwYDVQQKEwxEaWdpQ2Vy
# dCBJbmMxGTAXBgNVBAsTEHd3dy5kaWdpY2VydC5jb20xITAfBgNVBAMTGERpZ2lD
# ZXJ0IEFzc3VyZWQgSUQgQ0EtMTCCASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoC
# ggEBAOiCLZn5ysJClaWAc0Bw0p5WVFypxNJBBo/JM/xNRZFcgZ/tLJz4FlnfnrUk
# FcKYubR3SdyJxArar8tea+2tsHEx6886QAxGTZPsi3o2CAOrDDT+GEmC/sfHMUiA
# fB6iD5IOUMnGh+s2P9gww/+m9/uizW9zI/6sVgWQ8DIhFonGcIj5BZd9o8dD3QLo
# Oz3tsUGj7T++25VIxO4es/K8DCuZ0MZdEkKB4YNugnM/JksUkK5ZZgrEjb7Szgau
# rYRvSISbT0C58Uzyr5j79s5AXVz2qPEvr+yJIvJrGGWxwXOt1/HYzx4KdFxCuGh+
# t9V3CidWfA9ipD8yFGCV/QcEogkCAwEAAaOCA3owggN2MA4GA1UdDwEB/wQEAwIB
# hjA7BgNVHSUENDAyBggrBgEFBQcDAQYIKwYBBQUHAwIGCCsGAQUFBwMDBggrBgEF
# BQcDBAYIKwYBBQUHAwgwggHSBgNVHSAEggHJMIIBxTCCAbQGCmCGSAGG/WwAAQQw
# ggGkMDoGCCsGAQUFBwIBFi5odHRwOi8vd3d3LmRpZ2ljZXJ0LmNvbS9zc2wtY3Bz
# LXJlcG9zaXRvcnkuaHRtMIIBZAYIKwYBBQUHAgIwggFWHoIBUgBBAG4AeQAgAHUA
# cwBlACAAbwBmACAAdABoAGkAcwAgAEMAZQByAHQAaQBmAGkAYwBhAHQAZQAgAGMA
# bwBuAHMAdABpAHQAdQB0AGUAcwAgAGEAYwBjAGUAcAB0AGEAbgBjAGUAIABvAGYA
# IAB0AGgAZQAgAEQAaQBnAGkAQwBlAHIAdAAgAEMAUAAvAEMAUABTACAAYQBuAGQA
# IAB0AGgAZQAgAFIAZQBsAHkAaQBuAGcAIABQAGEAcgB0AHkAIABBAGcAcgBlAGUA
# bQBlAG4AdAAgAHcAaABpAGMAaAAgAGwAaQBtAGkAdAAgAGwAaQBhAGIAaQBsAGkA
# dAB5ACAAYQBuAGQAIABhAHIAZQAgAGkAbgBjAG8AcgBwAG8AcgBhAHQAZQBkACAA
# aABlAHIAZQBpAG4AIABiAHkAIAByAGUAZgBlAHIAZQBuAGMAZQAuMAsGCWCGSAGG
# /WwDFTASBgNVHRMBAf8ECDAGAQH/AgEAMHkGCCsGAQUFBwEBBG0wazAkBggrBgEF
# BQcwAYYYaHR0cDovL29jc3AuZGlnaWNlcnQuY29tMEMGCCsGAQUFBzAChjdodHRw
# Oi8vY2FjZXJ0cy5kaWdpY2VydC5jb20vRGlnaUNlcnRBc3N1cmVkSURSb290Q0Eu
# Y3J0MIGBBgNVHR8EejB4MDqgOKA2hjRodHRwOi8vY3JsMy5kaWdpY2VydC5jb20v
# RGlnaUNlcnRBc3N1cmVkSURSb290Q0EuY3JsMDqgOKA2hjRodHRwOi8vY3JsNC5k
# aWdpY2VydC5jb20vRGlnaUNlcnRBc3N1cmVkSURSb290Q0EuY3JsMB0GA1UdDgQW
# BBQVABIrE5iymQftHt+ivlcNK2cCzTAfBgNVHSMEGDAWgBRF66Kv9JLLgjEtUYun
# pyGd823IDzANBgkqhkiG9w0BAQUFAAOCAQEARlA+ybcoJKc4HbZbKa9Sz1LpMUer
# Vlx71Q0LQbPv7HUfdDjyslxhopyVw1Dkgrkj0bo6hnKtOHisdV0XFzRyR4WUVtHr
# uzaEd8wkpfMEGVWp5+Pnq2LN+4stkMLA0rWUvV5PsQXSDj0aqRRbpoYxYqioM+Sb
# OafE9c4deHaUJXPkKqvPnHZL7V/CSxbkS3BMAIke/MV5vEwSV/5f4R68Al2o/vsH
# OE8Nxl2RuQ9nRc3Wg+3nkg2NsWmMT/tZ4CMP0qquAHzunEIOz5HXJ7cW7g/DvXwK
# oO4sCFWFIrjrGBpN/CohrUkxg0eVd3HcsRtLSxwQnHcUwZ1PL1qVCCkQJjGCBDsw
# ggQ3AgEBMIGGMHIxCzAJBgNVBAYTAlVTMRUwEwYDVQQKEwxEaWdpQ2VydCBJbmMx
# GTAXBgNVBAsTEHd3dy5kaWdpY2VydC5jb20xMTAvBgNVBAMTKERpZ2lDZXJ0IFNI
# QTIgQXNzdXJlZCBJRCBDb2RlIFNpZ25pbmcgQ0ECEAcQVMq7Bj9Fg9JZSzSN5pAw
# CQYFKw4DAhoFAKB4MBgGCisGAQQBgjcCAQwxCjAIoAKAAKECgAAwGQYJKoZIhvcN
# AQkDMQwGCisGAQQBgjcCAQQwHAYKKwYBBAGCNwIBCzEOMAwGCisGAQQBgjcCARUw
# IwYJKoZIhvcNAQkEMRYEFNWwNOc5WcSJrPNUJDeCVRm0JOquMA0GCSqGSIb3DQEB
# AQUABIIBAGg5/M2JglbvWDsWSghVUipaziVLCZL+GzOBiwjsbXuS3j7cpZrSOrVa
# isbv5Odm2BKxY2agUs0EYAT+q7+B5B8FQtTCj3lpvnKtc1Ue6oV9plRJV7+vyREU
# aNwBP/zpP/nw3/wfIlhaGNXpu+muGdv7NpSkBdrb2+bYfnEpCXoudDlbIaPYaD9x
# yDyfvUYcyiJrYyaGzwM1adoxyFix0XLJnjBQyLpIPKghdp2nslevVPuh+2TZk+rO
# LLkHOE/hVy/oTlK55ahWG+iSIlwsFeDqC4+nJoYXMLJRI5a0gAchBKuu800lPfBp
# 2dynbmrt+0K+YuSegLwu75FuGxA7KYihggIPMIICCwYJKoZIhvcNAQkGMYIB/DCC
# AfgCAQEwdjBiMQswCQYDVQQGEwJVUzEVMBMGA1UEChMMRGlnaUNlcnQgSW5jMRkw
# FwYDVQQLExB3d3cuZGlnaWNlcnQuY29tMSEwHwYDVQQDExhEaWdpQ2VydCBBc3N1
# cmVkIElEIENBLTECEAMBmgI6/1ixa9bV6uYX8GYwCQYFKw4DAhoFAKBdMBgGCSqG
# SIb3DQEJAzELBgkqhkiG9w0BBwEwHAYJKoZIhvcNAQkFMQ8XDTE2MDcxMzEyNTE1
# MVowIwYJKoZIhvcNAQkEMRYEFKhdR6bn5x2g9a2NVTPjlIK7yCILMA0GCSqGSIb3
# DQEBAQUABIIBAJs/bprB6tpkEf4nZOVG2AUrqPe7yICeOkKfAMWM5iGusbE+Q4/B
# mUMdgReRVSBdsy0W5RJv0rlNvocbvrR4+beQwjg+nnDYlefrVZOBiRiiHJJNHPqt
# HTXK9JscuWwMjBCM2hv7w0o08jQPtupxalBS8CLj4iY2gi/KfrjZPteoTmBZKu9/
# 2/KtoG3zfisRvu/qBkZTKqO3DUKqCtvneicI1AMh+G9f0116n2Z8ENA4nCFzrgwN
# JmLCDSUKA/xBHhKyTPZ5I5wwL8Ah/HTkWoE4/XWHjGO3Ln43Jl7rHbFJhyJj+hAb
# uDm5YQvIG61+3mCrQLFeH2kvSUVhT4iNF78=
# SIG # End signature block
